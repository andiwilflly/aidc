/*
 * jQuery MultiSelect UI Widget 1.14pre
 * Copyright (c) 2012 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2+
 *   - jQuery UI 1.8 widget factory
 *
 * Optional:
 *   - jQuery UI effects
 *   - jQuery UI position utility
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */

/*!
 * jQuery Selectbox plugin 0.2
 *
 * Copyright 2011-2012, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 *
 * Date: Tue Jul 17 19:58:36 2012 +0300
 */

/*!
 * jScrollPane - v2.0.17 - 2013-08-17
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2013 Kelvin Luck
 * Dual licensed under the MIT or GPL licenses.
 */

// Copyright (c) 2013 Kelvin Luck

// Dual licensed under the MIT or GPL Version 2 licenses.

//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors

//     Underscore may be freely distributed under the MIT license.

//     (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/*!
 backbone.fetch-cache v1.4.1
 by Andy Appleton - https://github.com/mrappleton/backbone-fetch-cache.git
 */

window.onerror=function(e,t,n){return window.location.hash="error404",!1},$(document).ajaxSuccess(function(e,t,n){ICAD.DEBUG_MODE?console.info("[AJAX]: success | "+n.type+": "+_.last(n.url.split("/"))):!1}),$(document).ajaxError(function(e,t,n,r){ICAD.DEBUG_MODE?console.info("[AJAX]: error | "+n.type+": "+_.last(n.url.split("/"))):!1,$.growl.warning({message:"Ajax error: "+t.status})}),$("body").on("click",'label[for="week"], label[for="month"]',function(e){var t=$("#"+$(e.currentTarget).attr("for"))[0];t.checked=!t.checked,e.preventDefault()}),define("Helpers/global-events",function(){}),define("ReportModel",[],function(){return Backbone.Model.extend({url:formActionUri,"default":{id:"string",request:"string",requestObj:"object",compareId:"string",isSaved:"boolean",formData:"array"},initialize:function(){ICAD.DEBUG_MODE?console.info("[ReportModel]: initialize()"):!1},fetchModel:function(){ICAD.DEBUG_MODE?console.info("[ReportModel]: fetch()"):!1,ICAD.validate.reportModel(this)?this.fetch({type:"POST",data:{formData:this.id},processData:!0,success:function(e,t,n){e.set({errors:null})},error:function(e,t,n){var r=t.responseJSON?t.responseJSON.errors:{errors:[]};$.each(r,function(e,t){r[e].msg=t[Object.keys(t)[0]],r[e].class="error-item-wrapper"}),e.set({errors:r}),e=e.toJSON(),Backbone.history.fragment.match("compare/"+e.compareId)||e.router.navigate("dashboard"),e.router.navigate("compare/edit/"+e.compareId+"/"+e.id,{trigger:!0}),ICAD.loader.hide()}}):$.growl.warning({message:"Incorrect form data"})}})}),define("BaseRouter",["ReportModel"],function(e){return Backbone.Router.extend({startView:function(e,t,n,r){ICAD.DEBUG_MODE?console.info("[BaseRouter]: startView() | name: "+t):!1,e[t]||(e[t]=new n(r)),e[t].render(r)},restoreReportModel:function(t,n){ICAD.DEBUG_MODE?console.info("[BaseRouter]: restoreReportModel()"):!1,ICAD.loader.show($(".icad-container"));var r=new e;r.set({id:n,compareId:t,request:n,requestObj:ICAD.queryToJson(n),formData:ICAD.getFormFields(t),router:this,isSaved:!1}),this.reportsCollection.add(r),r.fetchModel()}})}),define("ReportsCollection",["ReportModel"],function(e){return Backbone.Collection.extend({model:e,initialize:function(){},saveReport:function(e){return this.get(e).set({isSaved:!0})},getSavedReports:function(){return this.where({isSaved:!0})}})}),function(e,t){var n=0,r=e(document);e.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:!1,multiple:!0,position:{},appendTo:"body"},_create:function(){var t=this.element.hide(),r=this.options;this.speed=e.fx.speeds._default,this._isOpen=!1,this._namespaceID=this.eventNamespace||"multiselect"+n;var i=(this.button=e('<button type="button"><span class="ui-icon ui-icon-triangle-1-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(r.classes).attr({title:t.attr("title"),"aria-haspopup":!0,tabIndex:t.attr("tabIndex")}).insertAfter(t),s=(this.buttonlabel=e("<span />")).html(r.noneSelectedText).appendTo(i),o=(this.menu=e("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(r.classes).appendTo(e(r.appendTo)),u=(this.header=e("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(o),a=(this.headerLinkContainer=e("<ul />")).addClass("ui-helper-reset").html(function(){return r.header===!0?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+r.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+r.uncheckAllText+"</span></a></li>":typeof r.header=="string"?"<li>"+r.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(u),f=(this.checkboxContainer=e("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(o);this._bindEvents(),this.refresh(!0),r.multiple||o.addClass("ui-multiselect-single"),n++},_init:function(){this.options.header===!1&&this.header.hide(),this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},refresh:function(t){var r=this.element,i=this.options,s=this.menu,o=this.checkboxContainer,u=[],a="",f=r.attr("id")||n++;r.find("option").each(function(t){var n=e(this),r=this.parentNode,s=this.innerHTML,o=this.title,l=this.value,c="ui-multiselect-"+(this.id||f+"-option-"+t),h=this.disabled,p=this.selected,d=["ui-corner-all"],v=(h?"ui-multiselect-disabled ":" ")+this.className,m;r.tagName==="OPTGROUP"&&(m=r.getAttribute("label"),e.inArray(m,u)===-1&&(a+='<li class="ui-multiselect-optgroup-label '+r.className+'"><a href="#">'+m+"</a></li>",u.push(m))),h&&d.push("ui-state-disabled"),p&&!i.multiple&&d.push("ui-state-active"),a+='<li class="'+v+'">',a+='<label for="'+c+'" title="'+o+'" class="'+d.join(" ")+'">',a+='<input id="'+c+'" name="multiselect_'+f+'" type="'+(i.multiple?"checkbox":"radio")+'" value="'+l+'" title="'+o+'"',p&&(a+=' checked="checked"',a+=' aria-selected="true"'),h&&(a+=' disabled="disabled"',a+=' aria-disabled="true"'),a+=" /><span>"+s+"</span></label></li>"}),o.html(a),this.labels=s.find("label"),this.inputs=this.labels.children("input"),this._setButtonWidth(),this._setMenuWidth(),this.button[0].defaultValue=this.update(),t||this._trigger("refresh")},update:function(){var t=this.options,n=this.inputs,r=n.filter(":checked"),i=r.length,s;return i===0?s=t.noneSelectedText:e.isFunction(t.selectedText)?s=t.selectedText.call(this,i,n.length,r.get()):/\d/.test(t.selectedList)&&t.selectedList>0&&i<=t.selectedList?s=r.map(function(){return e(this).next().html()}).get().join(", "):s=t.selectedText.replace("#",i).replace("#",n.length),this._setButtonValue(s),s},_setButtonValue:function(e){this.buttonlabel.text(e)},_bindEvents:function(){function i(){return t[t._isOpen?"close":"open"](),!1}var t=this,n=this.button;n.find("span").bind("click.multiselect",i),n.bind({click:i,keypress:function(e){switch(e.which){case 27:case 38:case 37:t.close();break;case 39:case 40:t.open()}},mouseenter:function(){n.hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},mouseleave:function(){e(this).removeClass("ui-state-hover")},focus:function(){n.hasClass("ui-state-disabled")||e(this).addClass("ui-state-focus")},blur:function(){e(this).removeClass("ui-state-focus")}}),this.header.delegate("a","click.multiselect",function(n){e(this).hasClass("ui-multiselect-close")?t.close():t[e(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"](),n.preventDefault()}),this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(n){n.preventDefault();var r=e(this),i=r.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),s=i.get(),o=r.parent().text();if(t._trigger("beforeoptgrouptoggle",n,{inputs:s,label:o})===!1)return;t._toggleChecked(i.filter(":checked").length!==i.length,i),t._trigger("optgrouptoggle",n,{inputs:s,label:o,checked:s[0].checked})}).delegate("label","mouseenter.multiselect",function(){e(this).hasClass("ui-state-disabled")||(t.labels.removeClass("ui-state-hover"),e(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(n){n.preventDefault();switch(n.which){case 9:case 27:t.close();break;case 38:case 40:case 37:case 39:t._traverse(n.which,this);break;case 13:e(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(n){var r=e(this),i=this.value,s=this.checked,o=t.element.find("option");if(this.disabled||t._trigger("click",n,{value:i,text:this.title,checked:s})===!1){n.preventDefault();return}r.focus(),r.attr("aria-selected",s),o.each(function(){this.value===i?this.selected=s:t.options.multiple||(this.selected=!1)}),t.options.multiple||(t.labels.removeClass("ui-state-active"),r.closest("label").toggleClass("ui-state-active",s),t.close()),t.element.trigger("change"),setTimeout(e.proxy(t.update,t),10)}),r.bind("mousedown."+this._namespaceID,function(n){var r=n.target;t._isOpen&&r!==t.button[0]&&r!==t.menu[0]&&!e.contains(t.menu[0],r)&&!e.contains(t.button[0],r)&&t.close()}),e(this.element[0].form).bind("reset.multiselect",function(){setTimeout(e.proxy(t.refresh,t),10)})},_setButtonWidth:function(){var e=this.element.outerWidth(),t=this.options;/\d/.test(t.minWidth)&&e<t.minWidth&&(e=t.minWidth),this.button.outerWidth(e)},_setMenuWidth:function(){var e=this.menu;e.outerWidth(this.button.outerWidth())},_traverse:function(t,n){var r=e(n),i=t===38||t===37,s=r.parent()[i?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)").first();if(!s.length){var o=this.menu.find("ul").last();this.menu.find("label")[i?"last":"first"]().trigger("mouseover"),o.scrollTop(i?o.height():0)}else s.find("label").trigger("mouseover")},_toggleState:function(e,t){return function(){this.disabled||(this[e]=t),t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(t,n){var r=n&&n.length?n:this.inputs,i=this;r.each(this._toggleState("checked",t)),r.eq(0).focus(),this.update();var s=r.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&e.inArray(this.value,s)>-1&&i._toggleState("selected",t).call(this)}),r.length&&this.element.trigger("change")},_toggleDisabled:function(t){this.button.attr({disabled:t,"aria-disabled":t})[t?"addClass":"removeClass"]("ui-state-disabled");var n=this.menu.find("input"),r="ech-multiselect-disabled";t?n=n.filter(":enabled").data(r,!0):n=n.filter(function(){return e.data(this,r)===!0}).removeData(r),n.attr({disabled:t,"arial-disabled":t}).parent()[t?"addClass":"removeClass"]("ui-state-disabled"),this.element.attr({disabled:t,"aria-disabled":t})},open:function(t){var n=this,r=this.button,i=this.menu,s=this.speed,o=this.options,u=[];if(this._trigger("beforeopen")===!1||r.hasClass("ui-state-disabled")||this._isOpen)return;var a=i.find("ul").last(),f=o.show;e.isArray(o.show)&&(f=o.show[0],s=o.show[1]||n.speed),f&&(u=[f,s]),a.scrollTop(0).height(o.height),this.position(),e.fn.show.apply(i,u),this.labels.filter(":not(.ui-state-disabled)").eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus"),r.addClass("ui-state-active"),this._isOpen=!0,this._trigger("open")},close:function(){if(this._trigger("beforeclose")===!1)return;var t=this.options,n=t.hide,r=this.speed,i=[];e.isArray(t.hide)&&(n=t.hide[0],r=t.hide[1]||this.speed),n&&(i=[n,r]),e.fn.hide.apply(this.menu,i),this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close")},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(e){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){return e.Widget.prototype.destroy.call(this),r.unbind(this._namespaceID),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},position:function(){var t=this.options;if(e.ui.position&&!e.isEmptyObject(t.position))t.position.of=t.position.of||this.button,this.menu.show().position(t.position).hide();else{var n=this.button.offset();this.menu.css({top:n.top+this.button.outerHeight(),left:n.left})}},_setOption:function(t,n){var r=this.menu;switch(t){case"header":r.find("div.ui-multiselect-header")[n?"show":"hide"]();break;case"checkAllText":r.find("a.ui-multiselect-all span").eq(-1).text(n);break;case"uncheckAllText":r.find("a.ui-multiselect-none span").eq(-1).text(n);break;case"height":r.find("ul").last().height(parseInt(n,10));break;case"minWidth":this.options[t]=parseInt(n,10),this._setButtonWidth(),this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[t]=n,this.update();break;case"classes":r.add(this.button).removeClass(this.options.classes).addClass(n);break;case"multiple":r.toggleClass("ui-multiselect-single",!n),this.options.multiple=n,this.element[0].multiple=n,this.refresh();break;case"position":this.position()}e.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery),define("multiselect",function(){}),ICAD.startDate=new Date(selectsArrayOptions.min_date.split(".")[2],selectsArrayOptions.min_date.split(".")[0]-1,selectsArrayOptions.min_date.split(".")[1]),ICAD.limitDate=new Date((new Date).getTime()-86400*(new Date).getDay()*1e3),ICAD.datepickerCustomize={week:function(e){e.$el.find(".js-datepicker").datepicker("destroy"),e.$el.find(".js-datepicker").datepicker({showOn:"both",yearRange:"2000:2020",buttonImageOnly:!1,dateFormat:"dd.mm.yy",weekHeader:"",firstDay:1,showWeek:!0,showOtherMonths:!0,minDate:ICAD.startDate,maxDate:ICAD.limitDate,selectOtherMonths:!0,afterShow:function(e){e.trigger.addClass("active")},onSelect:function(t,n){function r(e){e=new Date(e);var t=e.getDay(),n=e.getDate()-t+(t==0?-6:1);return new Date(e.setDate(n))}var i=$(this).datepicker("getDate"),s=n.settings.dateFormat||$.datepicker._defaults.dateFormat,o="",u=r(i),a=new Date(u.getFullYear(),u.getMonth(),u.getDate()-u.getDay()+7),f="",l="";n.input.attr("name")=="startDate"?(o=u,f=$.datepicker.iso8601Week(o),$("[name='startWeek']").val(f),$("[name='endDate']").datepicker("option","minDate",o)):(o=Date.parse(a)<Date.parse(ICAD.limitDate)?a:ICAD.limitDate,l=$.datepicker.iso8601Week(o),$("[name='endWeek']").val(l),$("[name='startDate']").datepicker("option","maxDate",o)),n.input.val($.datepicker.formatDate(s,o,n.settings)),e.hideFieldErrors(n.input),e.trigger("_enableDisableFields")},onClose:function(e,t){$(".ui-datepicker-trigger").removeClass("active")}});if(!!Backbone.history.fragment.match("compare/edit")){var t=e.reportModel.attributes.requestObj.startDate,n=e.reportModel.attributes.requestObj.endDate;e.reportModel.attributes.requestObj.period=="week"&&/\b\d{2}[-.]?\d{2}[-.]?\d{4}\b/.test(t)&&/\b\d{2}[-.]?\d{2}[-.]?\d{4}\b/.test(n)&&ICAD.validate.datepicker($("#start-date"))&&($("#start-date").datepicker("setDate",t),$(".ui-datepicker-current-day").click(),$("#end-date").datepicker("setDate",n),$(".ui-datepicker-current-day").click(),$(".ui-datepicker-trigger").removeClass("active"))}},month:function(e){var t,n,r,i;e.$el.find(".js-datepicker").datepicker("destroy"),e.$el.find(".js-datepicker").datepicker({showOn:"both",buttonImageOnly:!1,stepMonths:12,yearRange:"2000:2020",minDate:ICAD.startDate,maxDate:ICAD.limitDate,dateFormat:"dd.mm.yy",monthNames:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],afterShow:function(s){function o(e){if(typeof e=="number")return e;if(!e)return undefined;var t=e.split(".");return formatDate=new Date(t[2],t[1]-1,t[0])}s.trigger.addClass("active"),$(s.dpDiv).find(".ui-datepicker-month").hide(),s.selectedMonth=1;var u=$(s.dpDiv).find(".ui-datepicker-calendar").html(""),a=e.$el.find(".js-datepicker").datepicker("option","monthNames"),f="",l=0;if(!!Backbone.history.fragment.match("compare/edit")){var c=function(e){var t=(new Date(e.datepicker("getDate"))).getMonth()+1;return t.toString().length==2?t:"0"+t},h=function(e){return".20"+((new Date(e.datepicker("getDate"))).getYear()+"").slice(1)};Date.parse(new Date($("#start-date").datepicker("getDate")))<Date.parse(new Date("01.01.2015"))?t="01.01.2015":t="01."+c($("#start-date"))+h($("#start-date")),n="01."+c($("#end-date"))+h($("#end-date"))}$.each(a,function(e,r){e+=1;var i="01."+(e.toString().length==2?e:"0"+e)+"."+s.selectedYear,u="",a=2628e3;s.input.attr("name")=="startDate"?(Date.parse(o(t))==Date.parse(o(i))&&(u+=" selected "),o(n)<Date.parse(o(i))&&(u+=" is-disabled ")):(o(n)==Date.parse(o(i))&&(u+=" selected "),Date.parse(o(t))>Date.parse(o(i))&&(u+=" is-disabled ")),f+=l%3?"<td><p data-date="+i+' class="'+u+'">'+r+"</p></td>":'</tr><tr class="ui-month-row"><td><p data-date='+i+' class="'+u+'">'+r+"</p></td>",l+=1}),u.html(f);var p=(new Date).getYear(),d=ICAD.limitDate.getMonth();$.each($(".ui-datepicker-calendar tbody td"),function(e,t){(new Date(o($(t).find("p").data("date")))).getYear()==p&&e>=d&&$(t).find("p").addClass("is-disabled")}),$(s.dpDiv).find(".ui-month-row p").click(function(o){function u(e){var t=e.split(".");return formatDate=new Date(t[2],t[1]-1,t[0])}var a=$(o.currentTarget).data("date");if(s.input.attr("name")=="startDate")t=$(o.currentTarget).data("date"),r=$.datepicker.iso8601Week(u(t)),$("[name='startWeek']").val(r);else{var f=$(o.currentTarget).data("date").split(".");n=Date.parse(new Date(f[2],f[1],f[0]))-864e5,a=new Date(n),i=$.datepicker.iso8601Week(a),$("[name='endWeek']").val(i)}s.input.datepicker("setDate",a),ICAD.validate.datepicker(s.input),e.trigger("_enableDisableFields"),$("#ui-datepicker-div").hide(),$(".ui-datepicker-trigger").removeClass("active")})}})},setCurrentWeekValue:function(e){e.datepicker("getDate")&&(e.attr("name")=="endDate"?$("#end-week").val($.datepicker.iso8601Week(e.datepicker("getDate"))):$("#start-week").val($.datepicker.iso8601Week(e.datepicker("getDate"))))}},define("Helpers/datepicker-customize",function(){}),define("BaseView",["multiselect","Helpers/datepicker-customize"],function(){return Backbone.View.extend({tagName:"div",layout:$("#icad-content"),statusMsg:$("#icad-status-msg"),submitTemplate:createPath("ICAD/app/views/templates/partials/compare-submit.hbs"),datepickerTemplate:createPath("ICAD/app/views/templates/partials/compare-datepicker.hbs"),initialize:function(){this._reInitCustomSelect()},_compareByTemplate:function(e){return createPath("ICAD/app/views/templates/compare-by/compare-by-"+e+".hbs")},_reportingPeriodTemplate:function(e){return createPath("ICAD/app/views/templates/partials/reporting-period/reporting-period-"+e+".hbs")},_reportingTableTemplate:function(e){return createPath("ICAD/app/views/templates/partials/reporting-table/reporting-table-"+e+".hbs")},_clearAllOtherViews:function(e){e=e||"",this.layout.find("> div").not(e).html("")},_getData:function(e,t,n){return $.ajax({type:"post",url:e,data:t,async:!0,success:function(e){return e.filter?e=e.filter:!1,typeof n=="function"&&n(e),e}}).responseText},_getCompiledTemplate:function(e,t){return Handlebars.compile(e)(t)},_getTemplates:function(e){return ICAD.DEBUG_MODE&&console.info("[BaseView]: _getTemplates()"),function(t){var n=[];return $.each(t,function(e,r){n[e]=$.ajax({type:"get",url:t[e],async:!1,success:function(e){return e}}).responseText}),n}(e)},_enableDisableFields:function(e){ICAD.DEBUG_MODE?console.info("[BaseView]: _enableDisableFields()"):!1,e=e||$("[data-disabled-by]");var t=!0;return e.each(function(){function n(e){return $.each(e,function(e,n){if($(n).val()==null||$(n).val()==""||$(n).val()<=-2||$(n).closest(".item-wrapper").hasClass("error-item-wrapper"))t=!1;if(n=="#start-date"||n=="#end-date"){var r=$("#start-date").closest(".item-wrapper").find(".js-error-msg"),i=$("#end-date").closest(".item-wrapper").find(".js-error-msg");if(!ICAD.validate.datepickerMask.test($(n).val()))t=!1;else if(!!r.text().length||!!i.text().length)t=!1}}),t}var e=$(this);n(e.attr("data-disabled-by").split(","))?(e.removeClass("is-disabled"),e.is("select")&&e.multiselect("enable")):(e.addClass("is-disabled"),e.is("select")&&e.multiselect("disable"))}),t},_setEditingFieldValues:function(){ICAD.DEBUG_MODE?console.info("[BaseView]: _setEditingFieldValues()"):!1,$.each(this.reportModel.attributes.requestObj,function(e,t){e!="period"&&(t.length!=0?$('[name="'+e+'"]').val(t):!1)})},_refreshFormDataObj:function(e){ICAD.DEBUG_MODE&&console.info("[BaseView]: _refreshFormDataObj()");var t=this;$.ajax({type:"POST",url:selectsAjaxUri,data:{market:parseInt(t.reportModel.attributes.requestObj.market),type:t.reportModel.attributes.compareId},async:!1,success:function(n){if(t.reportModel.attributes.compareId=="fmm"||t.reportModel.attributes.compareId=="channel")t.reportModel.attributes.formData["select_"+e]=n.filter;ICAD.setAdditionalReportFields(t)}})},_setCustomFormsEl:function(){ICAD.DEBUG_MODE?console.info("[BaseView]: _setCustomFormsEl()"):!1,ICAD.multiselect.singleInit(this.$el.find(".js-custom-select"),this),ICAD.multiselect.multipleInit(this.$el.find(".js-custom-select-multiple"),this),this.$el.find(".js-datepicker").length&&ICAD.datepickerCustomize.week(this)},changeDatepickerPeriod:function(e){ICAD.DEBUG_MODE?console.info("[BaseView]: changeDatepickerPeriod()"):!1,ICAD.datepickerCustomize[$(e.currentTarget).attr("for")](this)},updateMultipleSelectList:function(e){ICAD.DEBUG_MODE?console.info("[BaseView]: updateMultipleSelectList()"):!1;var t=e.parent().find(".multiple-select-list"),n="",r,i=e.multiselect("getChecked").map(function(){return this}).get();for(var s=0,o=i.length;s<o;s++)n+='<span class="multiple-select-list__value">'+$.trim($(i[s]).attr("title"))+'<a class="multiple-select-list__close" data-id="'+$(i[s]).attr("id")+'">x</a>',s<o-1?n+='<span class="multiple-select-list__divider">|</span></span>':n+="</span>";i.length>0&&t.removeClass("is-disabled"),t.html(n),r=t.find("a"),r.on("click",function(e){e.preventDefault(),$("#"+$(this).data("id")).trigger("click")}),this._enableDisableFields()},_reInitCustomSelect:function(){ICAD.DEBUG_MODE&&console.info("[BaseView]: _reInitCustomSelect()");var e=this;ICAD.onWindowResize(function(){e.$el.find(".js-custom-select, .js-custom-select-multiple").multiselect("position")},100)}})}),define("ReportsListView",["BaseView"],function(e){return e.extend({el:"#reports-list-view",template:createPath("ICAD/app/views/templates/reports-list.hbs"),initialize:function(){},render:function(){ICAD.DEBUG_MODE&&console.info("[reportsListView]: render()"),this.statusMsg.html("What do you need to do?");var e=this;e._clearAllOtherViews("#saved-reports-view"),e.templateHTML?e.$el.html(e._getCompiledTemplate(e.templateHTML,{reportingList:selectsArrayOptions.reportingList})):$.get(this.template,function(t){e.templateHTML=t,e.$el.html(e._getCompiledTemplate(t,{reportingList:selectsArrayOptions.reportingList}))})}})}),define("SavedReportsView",["BaseView"],function(e){return e.extend({el:"#saved-reports-view",template:createPath("ICAD/app/views/templates/saved-reports.hbs"),initialize:function(){},render:function(e){ICAD.DEBUG_MODE&&console.info("[savedReportsView]: render()");var t=e.collection.getSavedReports(),n=this;n._clearAllOtherViews("#reports-list-view"),n.templateHTML?n.$el.html(n._getCompiledTemplate(n.templateHTML,{savedReports:t})):$.get(this.template,function(e){n.templateHTML=e,n._clearAllOtherViews("#reports-list-view"),n.$el.html(n._getCompiledTemplate(e,{savedReports:t}))})}})}),define("CompareByView",["BaseView","ReportModel"],function(e,t){return e.extend({el:"#compare-by-view",events:{"change   select":"onSelectChange","change   input":"onInputChange","submit   #compare-request-form":"sendCompareRequest","click   .js-icad-radio label":"changeDatepickerPeriod","keyup   .js-datepicker":"onDatePickerChange"},initialize:function(e){this.router=e.router,this.collection=e.collection,this._reInitCustomSelect(),this.listenTo(this,"_enableDisableFields",this._enableDisableFields)},render:function(e){ICAD.DEBUG_MODE&&console.info("[compareByView]: render()"),this.statusMsg.html("Quick access reports"),this.compareId=e.compareId,this.formData=ICAD.getFormFields(this.compareId);var t=this._getTemplates([this._compareByTemplate(this.compareId),this.datepickerTemplate]);this._clearAllOtherViews(),this.$el.html(this._getCompiledTemplate(t[0],{formData:this.formData,datePicker:this._getCompiledTemplate(t[1],{compareId:this.compareId})})),this.afterRender({})},renderForEditing:function(e){ICAD.DEBUG_MODE?console.info("[compareByView]: renderForEditing() "):!1,this.statusMsg.html("Quick access reports"),this.reportModel=this.collection.get(e.modelId),this.compareId=this.reportModel.attributes.compareId,this.formData=ICAD.getFormFields(this.compareId);var t=this._getTemplates([this._compareByTemplate(this.compareId),this.datepickerTemplate]);this._clearAllOtherViews(),this.$el.html(this._getCompiledTemplate(t[0],{reportModel:this.reportModel.toJSON(),formData:this.reportModel.attributes.formData,datePicker:this._getCompiledTemplate(t[1],{compareId:this.compareId,reportModel:this.reportModel.toJSON()})})),this.afterRender({afterRenderForEditing:!0})},afterRender:function(e){ICAD.DEBUG_MODE?console.info("[compareByView]: afterRender() "):!1,e.afterRenderForEditing&&(this._setEditingFieldValues(),ICAD.updateFormFields(this,$("#select-market"),e.afterRenderForEditing)),this._setCustomFormsEl(),e.afterRenderForEditing&&($('label[for="'+this.reportModel.attributes.requestObj.period+'"]').click(),$("#"+this.reportModel.attributes.requestObj.period).click()),ICAD.validate.datepicker(this.$el.find("#start-date")),ICAD.validate.datepicker(this.$el.find("#end-date")),this._enableDisableFields(),ICAD.loader.hide()},onSelectChange:function(e){ICAD.updateFormFields(this,$(e.currentTarget)),this.hideFieldErrors($(e.currentTarget)),this._enableDisableFields()},onInputChange:function(e){this.hideFieldErrors($(e.currentTarget)),this._enableDisableFields(),$(e.currentTarget).hasClass("js-datepicker")&&ICAD.datepickerCustomize.setCurrentWeekValue($(e.currentTarget))},hideFieldErrors:function(e){ICAD.DEBUG_MODE&&console.info("[CompareByView]: hideFieldErrors() ");var t=e.closest(".item-wrapper");t.hasClass("error-item-wrapper")&&(t.removeClass("error-item-wrapper").remove(".js-error-msg"),t.find(".js-error-msg").remove()),e.hasClass("datepicker__input")&&ICAD.validate.datepicker(e)},sendCompareRequest:function(e){ICAD.DEBUG_MODE?console.info("[CompareByView]: sendCompareRequest() "):!1,e.preventDefault();if(this._enableDisableFields()){ICAD.loader.show($(".compare-request-form__buttons"));var n=decodeURI(this.$el.find("#compare-request-form").serialize()).replace(/\//g,"%2F"),r=new t({id:n,compareId:this.compareId,request:n,requestObj:ICAD.queryToJson(n),formData:this.formData,router:this.router,isSaved:!1});this.collection.add(r),r.on("sync",function(){this.router.navigate("reporting/show/"+r.toJSON().compareId+"/"+r.id,{trigger:!0})},this),r.fetchModel()}else alert("some form values are incorrect")}})}),function(e,t){function s(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var n="selectbox",r=!1,i=!0;e.extend(s.prototype,{_isOpenSelectbox:function(e){if(!e)return r;var t=this._getInst(e);return t.isOpen},_isDisabledSelectbox:function(e){if(!e)return r;var t=this._getInst(e);return t.isDisabled},_attachSelectbox:function(t,s){function g(){var t,n,r=this.attr("id").split("_")[1];for(t in u._state)t!==r&&u._state.hasOwnProperty(t)&&(n=e("select[sb='"+t+"']")[0],n&&u._closeSelectbox(n))}function y(){var n=arguments[1]&&arguments[1].sub?!0:!1,r=arguments[1]&&arguments[1].disabled?!0:!1;arguments[0].each(function(s){var o=e(this),f=e("<li>"),d;o.is(":selected")&&(l.text(o.text()),p=i),s===m-1&&f.addClass("last"),!o.is(":disabled")&&!r?(d=e("<a>",{href:"#"+o.val(),rel:o.val()}).text(o.text()).bind("click.sb",function(n){n&&n.preventDefault&&n.preventDefault();var r=c,i=e(this),s=r.attr("id").split("_")[1];u._changeSelectbox(t,i.attr("rel"),i.text()),u._closeSelectbox(t)}).bind("mouseover.sb",function(){var t=e(this);t.parent().siblings().find("a").removeClass(a.settings.classFocus),t.addClass(a.settings.classFocus)}).bind("mouseout.sb",function(){e(this).removeClass(a.settings.classFocus)}),n&&d.addClass(a.settings.classSub),o.is(":selected")&&d.addClass(a.settings.classFocus),d.appendTo(f)):(d=e("<span>",{text:o.text()}).addClass(a.settings.classDisabled),n&&d.addClass(a.settings.classSub),d.appendTo(f)),f.appendTo(h)})}if(this._getInst(t))return r;var o=e(t),u=this,a=u._newInst(o),f,l,c,h,p=r,d=o.find("optgroup"),v=o.find("option"),m=v.length;o.attr("sb",a.uid),e.extend(a.settings,u._defaults,s),u._state[a.uid]=r,o.hide(),f=e("<div>",{id:"sbHolder_"+a.uid,"class":a.settings.classHolder,tabindex:o.attr("tabindex")}),l=e("<a>",{id:"sbSelector_"+a.uid,href:"#","class":a.settings.classSelector,click:function(n){n.preventDefault(),g.apply(e(this),[]);var r=e(this).attr("id").split("_")[1];u._state[r]?u._closeSelectbox(t):u._openSelectbox(t)}}),c=e("<a>",{id:"sbToggle_"+a.uid,href:"#","class":a.settings.classToggle,click:function(n){n.preventDefault(),g.apply(e(this),[]);var r=e(this).attr("id").split("_")[1];u._state[r]?u._closeSelectbox(t):u._openSelectbox(t)}}),c.appendTo(f),h=e("<ul>",{id:"sbOptions_"+a.uid,"class":a.settings.classOptions,css:{display:"none"}}),o.children().each(function(t){var n=e(this),r,i={};n.is("option")?y(n):n.is("optgroup")&&(r=e("<li>"),e("<span>",{text:n.attr("label")}).addClass(a.settings.classGroup).appendTo(r),r.appendTo(h),n.is(":disabled")&&(i.disabled=!0),i.sub=!0,y(n.find("option"),i))}),p||l.text(v.first().text()),e.data(t,n,a),f.data("uid",a.uid).bind("keydown.sb",function(t){var r=t.charCode?t.charCode:t.keyCode?t.keyCode:0,i=e(this),s=i.data("uid"),o=i.siblings("select[sb='"+s+"']").data(n),a=i.siblings(["select[sb='",s,"']"].join("")).get(0),f=i.find("ul").find("a."+o.settings.classFocus);switch(r){case 37:case 38:if(f.length>0){var l;e("a",i).removeClass(o.settings.classFocus),l=f.parent().prevAll("li:has(a)").eq(0).find("a"),l.length>0&&(l.addClass(o.settings.classFocus).focus(),e("#sbSelector_"+s).text(l.text()))}break;case 39:case 40:var l;e("a",i).removeClass(o.settings.classFocus),f.length>0?l=f.parent().nextAll("li:has(a)").eq(0).find("a"):l=i.find("ul").find("a").eq(0),l.length>0&&(l.addClass(o.settings.classFocus).focus(),e("#sbSelector_"+s).text(l.text()));break;case 13:f.length>0&&u._changeSelectbox(a,f.attr("rel"),f.text()),u._closeSelectbox(a);break;case 9:if(a){var o=u._getInst(a);o&&(f.length>0&&u._changeSelectbox(a,f.attr("rel"),f.text()),u._closeSelectbox(a))}var c=parseInt(i.attr("tabindex"),10);t.shiftKey?c--:c++,e("*[tabindex='"+c+"']").focus();break;case 27:u._closeSelectbox(a)}return t.stopPropagation(),!1}).delegate("a","mouseover",function(t){e(this).addClass(a.settings.classFocus)}).delegate("a","mouseout",function(t){e(this).removeClass(a.settings.classFocus)}),l.appendTo(f),h.appendTo(f),f.insertAfter(o),e("html").on("mousedown",function(t){t.stopPropagation(),e("select").selectbox("close")}),e([".",a.settings.classHolder,", .",a.settings.classSelector].join("")).mousedown(function(e){e.stopPropagation()})},_detachSelectbox:function(t){var i=this._getInst(t);if(!i)return r;e("#sbHolder_"+i.uid).remove(),e.data(t,n,null),e(t).show()},_changeSelectbox:function(t,n,r){var s,o=this._getInst(t);o&&(s=this._get(o,"onChange"),e("#sbSelector_"+o.uid).text(r)),n=n.replace(/\'/g,"\\'"),e(t).find("option[value='"+n+"']").attr("selected",i),o&&s?s.apply(o.input?o.input[0]:null,[n,o]):o&&o.input&&o.input.trigger("change")},_enableSelectbox:function(t){var i=this._getInst(t);if(!i||!i.isDisabled)return r;e("#sbHolder_"+i.uid).removeClass(i.settings.classHolderDisabled),i.isDisabled=r,e.data(t,n,i)},_disableSelectbox:function(t){var s=this._getInst(t);if(!s||s.isDisabled)return r;e("#sbHolder_"+s.uid).addClass(s.settings.classHolderDisabled),s.isDisabled=i,e.data(t,n,s)},_optionSelectbox:function(t,i,s){var o=this._getInst(t);if(!o)return r;o[i]=s,e.data(t,n,o)},_openSelectbox:function(t){var r=this._getInst(t);if(!r||r.isOpen||r.isDisabled)return;var s=e("#sbOptions_"+r.uid),o=parseInt(e(window).height(),10),u=e("#sbHolder_"+r.uid).offset(),a=e(window).scrollTop(),f=s.prev().height(),l=o-(u.top-a)-f/2,c=this._get(r,"onOpen");s.css({top:f+"px",maxHeight:l-f+"px"}),r.settings.effect==="fade"?s.fadeIn(r.settings.speed):s.slideDown(r.settings.speed),e("#sbToggle_"+r.uid).addClass(r.settings.classToggleOpen),this._state[r.uid]=i,r.isOpen=i,c&&c.apply(r.input?r.input[0]:null,[r]),e.data(t,n,r)},_closeSelectbox:function(t){var i=this._getInst(t);if(!i||!i.isOpen)return;var s=this._get(i,"onClose");i.settings.effect==="fade"?e("#sbOptions_"+i.uid).fadeOut(i.settings.speed):e("#sbOptions_"+i.uid).slideUp(i.settings.speed),e("#sbToggle_"+i.uid).removeClass(i.settings.classToggleOpen),this._state[i.uid]=r,i.isOpen=r,s&&s.apply(i.input?i.input[0]:null,[i]),e.data(t,n,i)},_newInst:function(e){var t=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:t,input:e,uid:Math.floor(Math.random()*99999999),isOpen:r,isDisabled:r,settings:{}}},_getInst:function(t){try{return e.data(t,n)}catch(r){throw"Missing instance data for this selectbox"}},_get:function(e,n){return e.settings[n]!==t?e.settings[n]:this._defaults[n]}}),e.fn.selectbox=function(t){var n=Array.prototype.slice.call(arguments,1);return typeof t=="string"&&t=="isDisabled"?e.selectbox["_"+t+"Selectbox"].apply(e.selectbox,[this[0]].concat(n)):t=="option"&&arguments.length==2&&typeof arguments[1]=="string"?e.selectbox["_"+t+"Selectbox"].apply(e.selectbox,[this[0]].concat(n)):this.each(function(){typeof t=="string"?e.selectbox["_"+t+"Selectbox"].apply(e.selectbox,[this].concat(n)):e.selectbox._attachSelectbox(this,t)})},e.selectbox=new s,e.selectbox.version="0.2"}(jQuery),define("selectbox",function(){}),function(e,t,n){e.fn.jScrollPane=function(r){function i(r,i){function V(t){var i,o,g,y,w,E,x=!1,T=!1;s=t;if(u===n)w=r.scrollTop(),E=r.scrollLeft(),r.css({overflow:"hidden",padding:0}),a=r.innerWidth()+F,f=r.innerHeight(),r.width(a),u=e('<div class="jspPane" />').css("padding",j).append(r.children()),l=e('<div class="jspContainer" />').css({width:a+"px",height:f+"px"}).append(u).appendTo(r);else{r.css("width",""),x=s.stickToBottom&&mt(),T=s.stickToRight&&gt(),y=r.innerWidth()+F!=a||r.outerHeight()!=f,y&&(a=r.innerWidth()+F,f=r.innerHeight(),l.css({width:a+"px",height:f+"px"}));if(!y&&I==c&&u.outerHeight()==h){r.width(a);return}I=c,u.css("width",""),r.width(a),l.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}u.css("overflow","auto"),t.contentWidth?c=t.contentWidth:c=u[0].scrollWidth,h=u[0].scrollHeight,u.css("overflow",""),p=c/a,d=h/f,v=d>1,m=p>1,!m&&!v?(r.removeClass("jspScrollable"),u.css({top:0,left:0,width:l.width()-F}),bt(),St(),Tt(),rt()):(r.addClass("jspScrollable"),i=s.maintainPosition&&(b||S),i&&(o=dt(),g=vt()),J(),Q(),Y(),i&&(ht(T?c-a:o,!1),ct(x?h-f:g,!1)),Et(),yt(),kt(),s.enableKeyboardNavigation&&xt(),s.clickOnTrack&&nt(),Nt(),s.hijackInternalLinks&&Ct()),s.autoReinitialise&&!B?B=setInterval(function(){V(s)},s.autoReinitialiseDelay):!s.autoReinitialise&&B&&clearInterval(B),w&&r.scrollTop(0)&&ct(w,!1),E&&r.scrollLeft(0)&&ht(E,!1),r.trigger("jsp-initialised",[m||v])}function J(){v&&(l.append(e('<div class="jspVerticalBar" />').append(e('<div class="jspCap jspCapTop" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragTop" />'),e('<div class="jspDragBottom" />'))),e('<div class="jspCap jspCapBottom" />'))),x=l.find(">.jspVerticalBar"),T=x.find(">.jspTrack"),g=T.find(">.jspDrag"),s.showArrows&&(L=e('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",et(0,-1)).bind("click.jsp",wt),A=e('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",et(0,1)).bind("click.jsp",wt),s.arrowScrollOnHover&&(L.bind("mouseover.jsp",et(0,-1,L)),A.bind("mouseover.jsp",et(0,1,A))),Z(T,s.verticalArrowPositions,L,A)),C=f,l.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){C-=e(this).outerHeight()}),g.hover(function(){g.addClass("jspHover")},function(){g.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",wt),g.addClass("jspActive");var n=t.pageY-g.position().top;return e("html").bind("mousemove.jsp",function(e){st(e.pageY-n,!1)}).bind("mouseup.jsp mouseleave.jsp",it),!1}),K())}function K(){T.height(C+"px"),b=0,N=s.verticalGutter+T.outerWidth(),u.width(a-N-F);try{x.position().left===0}catch(e){}}function Q(){m&&(l.append(e('<div class="jspHorizontalBar" />').append(e('<div class="jspCap jspCapLeft" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragLeft" />'),e('<div class="jspDragRight" />'))),e('<div class="jspCap jspCapRight" />'))),O=l.find(">.jspHorizontalBar"),M=O.find(">.jspTrack"),w=M.find(">.jspDrag"),s.showArrows&&(P=e('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",et(-1,0)).bind("click.jsp",wt),H=e('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",et(1,0)).bind("click.jsp",wt),s.arrowScrollOnHover&&(P.bind("mouseover.jsp",et(-1,0,P)),H.bind("mouseover.jsp",et(1,0,H))),Z(M,s.horizontalArrowPositions,P,H)),w.hover(function(){w.addClass("jspHover")},function(){w.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",wt),w.addClass("jspActive");var n=t.pageX-w.position().left;return e("html").bind("mousemove.jsp",function(e){ut(e.pageX-n,!1)}).bind("mouseup.jsp mouseleave.jsp",it),!1}),_=l.innerWidth(),G())}function G(){l.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){_-=e(this).outerWidth()}),M.width(_+"px"),S=0}function Y(){if(m&&v){var t=M.outerHeight(),n=T.outerWidth();C-=t,e(O).find(">.jspCap:visible,>.jspArrow").each(function(){_+=e(this).outerWidth()}),_-=n,f-=n,a-=t,M.parent().append(e('<div class="jspCorner" />').css("width",t+"px")),K(),G()}m&&u.width(l.outerWidth()-F+"px"),h=u.outerHeight(),d=h/f,m&&(D=Math.ceil(1/p*_),D>s.horizontalDragMaxWidth?D=s.horizontalDragMaxWidth:D<s.horizontalDragMinWidth&&(D=s.horizontalDragMinWidth),w.width(D+"px"),E=_-D,at(S)),v&&(k=Math.ceil(1/d*C),k>s.verticalDragMaxHeight?k=s.verticalDragMaxHeight:k<s.verticalDragMinHeight&&(k=s.verticalDragMinHeight),g.height(k+"px"),y=C-k,ot(b))}function Z(e,t,n,r){var i="before",s="after",o;t=="os"&&(t=/Mac/.test(navigator.platform)?"after":"split"),t==i?s=t:t==s&&(i=t,o=n,n=r,r=o),e[i](n)[s](r)}function et(e,t,n){return function(){return tt(e,t,this,n),this.blur(),!1}}function tt(t,n,r,i){r=e(r).addClass("jspActive");var u,a,f=!0,l=function(){t!==0&&o.scrollByX(t*s.arrowButtonSpeed),n!==0&&o.scrollByY(n*s.arrowButtonSpeed),a=setTimeout(l,f?s.initialDelay:s.arrowRepeatFreq),f=!1};l(),u=i?"mouseout.jsp":"mouseup.jsp",i=i||e("html"),i.bind(u,function(){r.removeClass("jspActive"),a&&clearTimeout(a),a=null,i.unbind(u)})}function nt(){rt(),v&&T.bind("mousedown.jsp",function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var r=e(this),i=r.offset(),u=t.pageY-i.top-b,a,l=!0,c=function(){var e=r.offset(),n=t.pageY-e.top-k/2,i=f*s.scrollPagePercent,d=y*i/(h-f);if(u<0)b-d>n?o.scrollByY(-i):st(n);else{if(!(u>0)){p();return}b+d<n?o.scrollByY(i):st(n)}a=setTimeout(c,l?s.initialDelay:s.trackClickRepeatFreq),l=!1},p=function(){a&&clearTimeout(a),a=null,e(document).unbind("mouseup.jsp",p)};return c(),e(document).bind("mouseup.jsp",p),!1}}),m&&M.bind("mousedown.jsp",function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var r=e(this),i=r.offset(),u=t.pageX-i.left-S,f,l=!0,h=function(){var e=r.offset(),n=t.pageX-e.left-D/2,i=a*s.scrollPagePercent,d=E*i/(c-a);if(u<0)S-d>n?o.scrollByX(-i):ut(n);else{if(!(u>0)){p();return}S+d<n?o.scrollByX(i):ut(n)}f=setTimeout(h,l?s.initialDelay:s.trackClickRepeatFreq),l=!1},p=function(){f&&clearTimeout(f),f=null,e(document).unbind("mouseup.jsp",p)};return h(),e(document).bind("mouseup.jsp",p),!1}})}function rt(){M&&M.unbind("mousedown.jsp"),T&&T.unbind("mousedown.jsp")}function it(){e("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),g&&g.removeClass("jspActive"),w&&w.removeClass("jspActive")}function st(e,t){if(!v)return;e<0?e=0:e>y&&(e=y),t===n&&(t=s.animateScroll),t?o.animate(g,"top",e,ot):(g.css("top",e),ot(e))}function ot(e){e===n&&(e=g.position().top),l.scrollTop(0),b=e;var t=b===0,i=b==y,s=e/y,o=-s*(h-f);if(q!=t||U!=i)q=t,U=i,r.trigger("jsp-arrow-change",[q,U,R,z]);ft(t,i),u.css("top",o),r.trigger("jsp-scroll-y",[-o,t,i]).trigger("scroll")}function ut(e,t){if(!m)return;e<0?e=0:e>E&&(e=E),t===n&&(t=s.animateScroll),t?o.animate(w,"left",e,at):(w.css("left",e),at(e))}function at(e){e===n&&(e=w.position().left),l.scrollTop(0),S=e;var t=S===0,i=S==E,s=e/E,o=-s*(c-a);if(R!=t||z!=i)R=t,z=i,r.trigger("jsp-arrow-change",[q,U,R,z]);lt(t,i),u.css("left",o),r.trigger("jsp-scroll-x",[-o,t,i]).trigger("scroll")}function ft(e,t){s.showArrows&&(L[e?"addClass":"removeClass"]("jspDisabled"),A[t?"addClass":"removeClass"]("jspDisabled"))}function lt(e,t){s.showArrows&&(P[e?"addClass":"removeClass"]("jspDisabled"),H[t?"addClass":"removeClass"]("jspDisabled"))}function ct(e,t){var n=e/(h-f);st(n*y,t)}function ht(e,t){var n=e/(c-a);ut(n*E,t)}function pt(t,n,r){var i,o,u,c=0,h=0,p,d,v,m,g,y;try{i=e(t)}catch(b){return}o=i.outerHeight(),u=i.outerWidth(),l.scrollTop(0),l.scrollLeft(0);while(!i.is(".jspPane")){c+=i.position().top,h+=i.position().left,i=i.offsetParent();if(/^body|html$/i.test(i[0].nodeName))return}p=vt(),v=p+f,c<p||n?g=c-s.verticalGutter:c+o>v&&(g=c-f+o+s.verticalGutter),isNaN(g)||ct(g,r),d=dt(),m=d+a,h<d||n?y=h-s.horizontalGutter:h+u>m&&(y=h-a+u+s.horizontalGutter),isNaN(y)||ht(y,r)}function dt(){return-u.position().left}function vt(){return-u.position().top}function mt(){var e=h-f;return e>20&&e-vt()<10}function gt(){var e=c-a;return e>20&&e-dt()<10}function yt(){l.unbind(X).bind(X,function(e,t,n,r){var i=S,u=b;return o.scrollBy(n*s.mouseWheelSpeed,-r*s.mouseWheelSpeed,!1),i==S&&u==b})}function bt(){l.unbind(X)}function wt(){return!1}function Et(){u.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(e){pt(e.target,!1)})}function St(){u.find(":input,a").unbind("focus.jsp")}function xt(){function a(){var e=S,r=b;switch(t){case 40:o.scrollByY(s.keyboardSpeed,!1);break;case 38:o.scrollByY(-s.keyboardSpeed,!1);break;case 34:case 32:o.scrollByY(f*s.scrollPagePercent,!1);break;case 33:o.scrollByY(-f*s.scrollPagePercent,!1);break;case 39:o.scrollByX(s.keyboardSpeed,!1);break;case 37:o.scrollByX(-s.keyboardSpeed,!1)}return n=e!=S||r!=b,n}var t,n,i=[];m&&i.push(O[0]),v&&i.push(x[0]),u.focus(function(){r.focus()}),r.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(r){if(r.target!==this&&(!i.length||!e(r.target).closest(i).length))return;var s=S,o=b;switch(r.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:t=r.keyCode,a();break;case 35:ct(h-f),t=null;break;case 36:ct(0),t=null}return n=r.keyCode==t&&s!=S||o!=b,!n}).bind("keypress.jsp",function(e){return e.keyCode==t&&a(),!n}),s.hideFocus?(r.css("outline","none"),"hideFocus"in l[0]&&r.attr("hideFocus",!0)):(r.css("outline",""),"hideFocus"in l[0]&&r.attr("hideFocus",!1))}function Tt(){r.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function Nt(){if(location.hash&&location.hash.length>1){var t,n,r=escape(location.hash.substr(1));try{t=e("#"+r+', a[name="'+r+'"]')}catch(i){return}t.length&&u.find(r)&&(l.scrollTop()===0?n=setInterval(function(){l.scrollTop()>0&&(pt(t,!0),e(document).scrollTop(l.position().top),clearInterval(n))},50):(pt(t,!0),e(document).scrollTop(l.position().top)))}}function Ct(){if(e(document.body).data("jspHijack"))return;e(document.body).data("jspHijack",!0),e(document.body).delegate("a[href*=#]","click",function(n){var r=this.href.substr(0,this.href.indexOf("#")),i=location.href,s,o,u,a,f,l;location.href.indexOf("#")!==-1&&(i=location.href.substr(0,location.href.indexOf("#")));if(r!==i)return;s=escape(this.href.substr(this.href.indexOf("#")+1)),o;try{o=e("#"+s+', a[name="'+s+'"]')}catch(c){return}if(!o.length)return;u=o.closest(".jspScrollable"),a=u.data("jsp"),a.scrollToElement(o,!0),u[0].scrollIntoView&&(f=e(t).scrollTop(),l=o.offset().top,(l<f||l>f+e(t).height())&&u[0].scrollIntoView()),n.preventDefault()})}function kt(){var e,t,n,r,i,s=!1;l.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(o){var u=o.originalEvent.touches[0];e=dt(),t=vt(),n=u.pageX,r=u.pageY,i=!1,s=!0}).bind("touchmove.jsp",function(u){if(!s)return;var a=u.originalEvent.touches[0],f=S,l=b;return o.scrollTo(e+n-a.pageX,t+r-a.pageY),i=i||Math.abs(n-a.pageX)>5||Math.abs(r-a.pageY)>5,f==S&&l==b}).bind("touchend.jsp",function(e){s=!1}).bind("click.jsp-touchclick",function(e){if(i)return i=!1,!1})}function Lt(){var e=vt(),t=dt();r.removeClass("jspScrollable").unbind(".jsp"),r.replaceWith(W.append(u.children())),W.scrollTop(e),W.scrollLeft(t),B&&clearInterval(B)}var s,o=this,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q=!0,R=!0,U=!1,z=!1,W=r.clone(!1,!1).empty(),X=e.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";r.css("box-sizing")==="border-box"?(j=0,F=0):(j=r.css("paddingTop")+" "+r.css("paddingRight")+" "+r.css("paddingBottom")+" "+r.css("paddingLeft"),F=(parseInt(r.css("paddingLeft"),10)||0)+(parseInt(r.css("paddingRight"),10)||0)),e.extend(o,{reinitialise:function(t){t=e.extend({},s,t),V(t)},scrollToElement:function(e,t,n){pt(e,t,n)},scrollTo:function(e,t,n){ht(e,n),ct(t,n)},scrollToX:function(e,t){ht(e,t)},scrollToY:function(e,t){ct(e,t)},scrollToPercentX:function(e,t){ht(e*(c-a),t)},scrollToPercentY:function(e,t){ct(e*(h-f),t)},scrollBy:function(e,t,n){o.scrollByX(e,n),o.scrollByY(t,n)},scrollByX:function(e,t){var n=dt()+Math[e<0?"floor":"ceil"](e),r=n/(c-a);ut(r*E,t)},scrollByY:function(e,t){var n=vt()+Math[e<0?"floor":"ceil"](e),r=n/(h-f);st(r*y,t)},positionDragX:function(e,t){ut(e,t)},positionDragY:function(e,t){st(e,t)},animate:function(e,t,n,r){var i={};i[t]=n,e.animate(i,{duration:s.animateDuration,easing:s.animateEase,queue:!1,step:r})},getContentPositionX:function(){return dt()},getContentPositionY:function(){return vt()},getContentWidth:function(){return c},getContentHeight:function(){return h},getPercentScrolledX:function(){return dt()/(c-a)},getPercentScrolledY:function(){return vt()/(h-f)},getIsScrollableH:function(){return m},getIsScrollableV:function(){return v},getContentPane:function(){return u},scrollToBottom:function(e){st(y,e)},hijackInternalLinks:e.noop,destroy:function(){Lt()}}),V(i)}return r=e.extend({},e.fn.jScrollPane.defaults,r),e.each(["arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){r[this]=r[this]||r.speed}),this.each(function(){var t=e(this),n=t.data("jsp");n?n.reinitialise(r):(e("script",t).filter('[type="text/javascript"],:not([type])').remove(),n=new i(t,r),t.data("jsp",n))})},e.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:!1,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:n,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:3,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}(jQuery,this),define("scrollpane",function(){}),define("ReportingView",["BaseView","selectbox","scrollpane"],function(e,t){return e.extend({el:"#reporting-view",events:{"change #select-report-chart":"changeReportingChart"},template:createPath("ICAD/app/views/templates/reporting.hbs"),render:function(e){ICAD.DEBUG_MODE&&console.info("[reportingView]: render()"),this.statusMsg.html("Quick access reports"),this.reportModel=e.reportModel;var t=this;ICAD.setAdditionalReportFields(t);var n=t._getTemplates([this.template,this._reportingPeriodTemplate(this.reportModel.get("compareId")),this._reportingTableTemplate(this.reportModel.get("compareId"))]);t._clearAllOtherViews();var r=[],i=[];$.each(t.reportModel.toJSON().data.report.data,function(e,t){t.objectId!=0&&t.objectId!=-1?r.push(t):i.push(t)}),$.each(i,function(e,t){r.push(t)}),t.reportModel.toJSON().data.report.data=r,this.$el.html(this._getCompiledTemplate(n[0],{reportModel:t.reportModel.toJSON(),reportingPeriod:t._getCompiledTemplate(n[1],{reportModel:t.reportModel.toJSON()}),reportingTable:t._getCompiledTemplate(n[2],{reportModel:t.reportModel.toJSON()})})),this.afterRender()},afterRender:function(){ICAD.DEBUG_MODE&&console.info("[reportingView]: afterRender()");var e=this.$el.find("#select-report-chart option:first-child").val(),t=this,n=t.reportModel.toJSON().request,r=ICAD.getParameterByName("chart",n);!r||(e=r,this.$el.find("#select-report-chart").val(e)),this._setCustomFormsEl(),require(["Helpers/charts"],function(n){n.buildChart({$el:t.$el.find("#reporting-chart"),$elR:t.$el.find("#reporting-chart-range"),series:e,data:t.reportModel.toJSON().data.report.data})})},changeReportingChart:function(){ICAD.DEBUG_MODE&&console.info("[reportingView]: changeReportingChart()");var e=this.$el.find("#select-report-chart option:selected").val(),t=this,n=t.reportModel.toJSON().request,r=ICAD.getParameterByName("chart",n),i="reporting/show/"+t.reportModel.toJSON().compareId+"/"+t.reportModel.id;r?i=ICAD.updateQueryStringParameter(i,"chart",e):i+="&chart="+e,t.reportModel.toJSON().router.navigate(i,{trigger:!0})}})}),define("Helpers/lazy-load",[],function(){var e=function(e){var t=e.detailsWrapper.scrollTop()+30,n=Math.ceil((t+450)/e.partHeight),r=[],i=n*e.partHeight,s=i-(t+450),o=e.partHeight-450;return r.push(n),s>o&&r.unshift(n-1),r};return{loadParts:function(t,n){var r=_.isEqual(t.liveSort,n);t.currentParts=e(t);var i=!1;_.indexOf(t.currentParts,t.reportDetailsLimit)==-1&&$.each(t.currentParts,function(e,n){_.indexOf(t.liveParts,n)==-1&&(i=!0)}),r==0&&(i=!0),i&&(ICAD.loader.show($("#reporting-details")),t.detailsSide.find(".tbody").stop().animate({opacity:0},400),t.detailsTable.find(".tbody").stop().animate({opacity:0},400,function(){t.sendMessageToWorker(n)}),t.liveParts=t.currentParts,t.liveSort=ICAD.cloneObject(n))}}}),define("ReportingDetailsView",["BaseView","Helpers/lazy-load"],function(e,t){return e.extend({el:"#reporting-details-view",template:createPath("ICAD/app/views/templates/reporting-details.hbs"),detailsSide:createPath("ICAD/app/views/templates/partials/reporting-details-side.hbs"),detailsPartial:createPath("ICAD/app/views/templates/partials/reporting-details-part.hbs"),events:{"click #reporting-details-head .th":"rebuildTableAfterSort","click #reporting-details-side-head .th":"rebuildTableAfterSort"},detailsTableHeight:450+ICAD.getScrollBarWidth(),itemHeight:30,itemsPerPart:100,loadedParts:[],liveParts:[],currentParts:[],partHeight:0,scrollBarWidth:ICAD.getScrollBarWidth(),initialize:function(){this.partHeight=this.itemsPerPart*this.itemHeight},beforeRender:function(e){ICAD.DEBUG_MODE&&console.info("[reportingDetailsView]: beforeRender()");var t=this;t.$el.css("opacity",0),t.createWebWorker(),t.totalCount=0,t.reportModel=e.reportModel,t.objectId=e.objectId,t.loadedParts=[],t.liveParts=[1],t.currentParts=[1],t.liveSort={sortBy:"",sortOrder:""},t.currentSort={sortBy:"",sortOrder:""},t.loadedReporData=!1,t._refreshFormDataObj(t.reportModel.attributes.compareId),$.ajax({type:"get",url:createPath("ICAD/app/views/templates/partials/reporting-details-side.hbs"),success:function(e){t.reportDetailsSide=e,$.ajax({type:"get",url:createPath("ICAD/app/views/templates/partials/reporting-details-part.hbs"),success:function(e){t.reportDetailsPartial=e,t.sendMessageToWorker({sortBy:"",sortOrder:""})}})}})},render:function(e){ICAD.DEBUG_MODE&&console.info("[reportingDetailsView]: render()"),this.statusMsg.html("What do you need to do?"),e.count!=null&&(this.totalCount=e.count);var t=this;$.ajax({type:"get",url:createPath("ICAD/app/views/templates/reporting-details.hbs"),success:function(n){$.ajax({type:"get",url:t._reportingPeriodTemplate(t.reportModel.get("compareId")),success:function(r){t._clearAllOtherViews(),t.$el.html(t._getCompiledTemplate(n,{reportModel:t.reportModel.toJSON(),reportDetails:e,reportingPeriod:t._getCompiledTemplate(r,{reportModel:t.reportModel.toJSON()})})),t.afterRender(e)}})}}),t.reportDetailsCount=e.count,t.reportDetailsLimit=Math.ceil(e.count/t.itemsPerPart)+1},afterRender:function(e){ICAD.DEBUG_MODE&&console.info("[reportingDetailsView]: afterRender()");var n=this;n.detailsSide=n.$el.find("#reporting-details-side"),n.detailsWrapper=n.$el.find("#reporting-details-wrapper"),n.detailsSideInner=n.$el.find("#reporting-details-side .js-reporting-details-inner"),n.detailsSideHead=n.$el.find("#reporting-details-side-head"),n.detailsSideTable=n.$el.find("#reporting-details-names"),n.detailsInner=n.$el.find("#reporting-details-wrapper .js-reporting-details-inner"),n.detailsHead=n.$el.find("#reporting-details-head"),n.detailsTable=n.$el.find("#reporting-details-table"),n.detailsMover=n.$el.find(".js-reporting-details-mover"),n.sortColumns=n.$el.find("#reporting-details-head .th"),ICAD.onScroll(n.detailsWrapper,function(){n.detailsHead.parent().scrollLeft(n.detailsWrapper.offset().left-n.detailsInner.offset().left),n.detailsSide.scrollTop(n.detailsWrapper.offset().top-n.detailsInner.offset().top)},1),ICAD.onScroll(n.detailsSide,function(){n.detailsSideHead.parent().scrollLeft(n.detailsSide.offset().left-n.detailsSideInner.offset().left),n.detailsSide.scrollTop(n.detailsWrapper.offset().top-n.detailsInner.offset().top)},1),ICAD.onScroll(this.detailsWrapper,function(){t.loadParts(n,n.currentSort)},200),n.detailsSideInner.height(n.totalCount*n.itemHeight),n.detailsInner.height(n.totalCount*n.itemHeight);if(n.totalCount){var r=n.totalCount*n.itemHeight+n.scrollBarWidth+1,i=r>=n.detailsTableHeight?n.detailsTableHeight:r;n.detailsSide.height(i),n.detailsWrapper.height(i)}else n.$el.find("#reporting-details").html($("<div/>",{"class":"sub-title",text:"Sorry, no data available."}));n.refreshTableData(e),globalHelpers.FOUC(n.$el,1500)},createWebWorker:function(){var e=this;ICAD.workers&&(ICAD.workers.reportDetails=new Worker(createPath("ICAD/app/utils/workers/details-data-worker.js")),ICAD.workers.reportDetails.addEventListener("message",function(t){e.totalCount?(e.detailsTable.find(".tbody").html(""),e.detailsSide.find(".tbody").html(""),e.refreshTableData(t.data.data),e.detailsMover.css("height",(e.currentParts[0]-1)*e.partHeight)):e.render(t.data.data)},!1))},sendMessageToWorker:function(e){var t=this;ICAD.workers?ICAD.workers.reportDetails.postMessage({request:{parts:t.currentParts,sort:e},formDetailedActionUri:formDetailedActionUri,compareId:t.reportModel.attributes.compareId,objectId:t.objectId,modelId:t.reportModel.attributes.id}):require(["Helpers/workers/details-data-helper"],function(){function n(){return t.reportModel.attributes.id+"&"+t.reportModel.attributes.compareId+"Id="+t.objectId}t.loadedReporData?detailsData.prepareDataPart(t.loadedReporData,{parts:t.currentParts,sort:e},function(e){t.detailsTable.find(".tbody").html(""),t.detailsSide.find(".tbody").html(""),t.refreshTableData(e.data),t.detailsMover.css("height",(t.currentParts[0]-1)*t.partHeight)}):detailsData.loadData(formDetailedActionUri,n(),function(n){n=JSON.parse(n),detailsData.prepareDataPart(n,{parts:t.currentParts,sort:e},function(e){t.render(e.data)}),t.loadedReporData=n})})},refreshTableData:function(e){var t=this._getCompiledTemplate(this.reportDetailsSide,{reportDetails:e}),n=this._getCompiledTemplate(this.reportDetailsPartial,{reportDetails:e}),r=this;this.detailsSide.find(".tbody").prepend(t),this.detailsTable.find(".tbody").prepend(n),r.recalculateTable(r),this.detailsSide.find(".tbody").stop().animate({opacity:1},400),this.detailsTable.find(".tbody").stop().animate({opacity:1},400,function(){ICAD.loader.hide()})},recalculateTable:function(e){e.detailsInner.width(e.detailsTable.width()),e.detailsHead.width(e.detailsTable.width()),e.detailsSideInner.width(e.detailsSideTable.width()),e.detailsSideHead.width(e.detailsSideTable.width()),e.rowsDetailed=$(e.detailsTable.find(".tbody .tr")),e.rowsSide=$(e.detailsSideTable.find(".tbody .tr")),e.loadRows=e.rowsDetailed.size(),e.defaultHeightLoadParts=e.rowsDetailed.size()*30,e.liveHeightLoadParts=0,e.rowsDetailed.each(function(t,n){e.liveHeightLoadParts+=$(this).height(),$(e.rowsSide[t]).find(".td").height($(this).height())}),e.diffHeightLoadParts=e.liveHeightLoadParts-e.defaultHeightLoadParts,e.detailsSideInner.height(e.totalCount*e.itemHeight+e.diffHeightLoadParts),e.detailsInner.height(e.totalCount*e.itemHeight+e.diffHeightLoadParts),e.detailsSideHead.find(".th").each(function(t,n){var r=$(e.detailsSideTable.find(".tbody .tr:first .td")[t]).outerWidth(!0);$(this).css("width",r)}),e.detailsHead.find(".th").each(function(t,n){var r=$(e.detailsTable.find(".tbody .tr:first .td")[t]).outerWidth(!0);$(this).css("width",r)})},rebuildTableAfterSort:function(e){var n=this,r=$(e.currentTarget).find("span"),i=n.detailsHead.find(".th span"),s=n.detailsSideHead.find(".th span"),o=s.add(i),u=r.attr("data-sort"),a=r.attr("data-order"),f={sortBy:u,sortOrder:a};o.not(r).each(function(){$(this).attr("data-order","")});switch(a){case"":r.attr("data-order","asc"),a="asc",f.sortOrder=a;break;case"asc":r.attr("data-order","desc"),a="desc",f.sortOrder=a;break;case"desc":r.attr("data-order",""),a="",f.sortOrder=a;break;default:r.attr("data-order","")}a==""&&(f.sortBy=""),n.currentSort.sortBy=f.sortBy,n.currentSort.sortOrder=f.sortOrder,t.loadParts(n,f)}})}),define("MainRouter",["BaseRouter","ReportsCollection","ReportModel","ReportsListView","SavedReportsView","CompareByView","ReportingView","ReportingDetailsView"],function(e,t,n,r,i,s,o,u){return e.extend({routes:{"":"dashboard",dashboard:"dashboard","compare/:compareId":"compare","compare/edit/:compareId/:reportId":"editCompare","reporting/show/:compareId/:reportId":"showReport","reporting/save/:compareId/:reportId":"saveReport","reporting/export/:compareId/:reportId":"exportReport","reporting/details/:compareId/:dataId/:reportId":"showDetailsReport","*actions":"error404"},initialize:function(){this.reportsCollection=new t,this.on("route",function(e,t){$("#ui-datepicker-div").hide()})},error404:function(e){ICAD.DEBUG_MODE&&(console.groupEnd(),console.group("[route]: error404")),$.growl.error({message:"Redirect to 'dashboard' page"}),ICAD.loader.hide(),this.navigate("dashboard",{trigger:!0})},dashboard:function(){ICAD.DEBUG_MODE&&(console.groupEnd(),console.group("[route]: dashboard")),this.startView(this,"reportsListView",r),this.startView(this,"savedReportsView",i,{collection:this.reportsCollection})},compare:function(e){ICAD.DEBUG_MODE&&(console.groupEnd(),console.group("[route]: compare")),this.startView(this,"compareByView",s,{compareId:e,router:this,collection:this.reportsCollection})},editCompare:function(e,t){ICAD.DEBUG_MODE&&(console.groupEnd(),console.group("[route]: editCompare")),t=decodeURI(t).replace(/\//g,"%2F"),this.compareByView||(ICAD.DEBUG_MODE?console.info("[BaseRouter]: startView() | name: compareByView"):!1,this.compareByView=new s({compareId:e,router:this,collection:this.reportsCollection}));if(this.reportsCollection.get(t)==undefined){var n=this;this.restoreReportModel(e,t),this.reportsCollection.get(t).on("sync",function(){n.compareByView.renderForEditing({modelId:t})})}else this.compareByView.renderForEditing({modelId:t})},showReport:function(e,t){ICAD.DEBUG_MODE&&(console.groupEnd(),console.group("[route]: showReport")),t=decodeURI(t).replace(/\//g,"%2F"),$("#reporting-view").css("opacity",1),this.reportsCollection.get(t)==undefined?(this.restoreReportModel(e,t),this.reportsCollection.get(t).on("sync",function(){this.startView(this,"reportingView",o,{reportModel:this.reportsCollection.get(t)})},this)):this.startView(this,"reportingView",o,{reportModel:this.reportsCollection.get(t)})},saveReport:function(e,t){ICAD.DEBUG_MODE?alert("saveReport route was disabled"):!1},exportReport:function(e,t){alert("bingo")},showDetailsReport:function(e,t,n){ICAD.DEBUG_MODE&&(console.groupEnd(),console.group("[route]: showDetailsReport")),n=decodeURI(n).replace(/\//g,"%2F"),ICAD.loader.show($(".icad-container")),$("#reporting-view").animate({opacity:0},2e3,function(){$("html, body").animate({scrollTop:0},700)}),this.reportingDetailsView||(ICAD.DEBUG_MODE&&console.info("[BaseRouter]: startView() | name: reportingDetailsView"),this.reportingDetailsView=new u({router:this,collection:this.reportsCollection}));if(this.reportsCollection.get(n)==undefined){var r=this;this.restoreReportModel(e,n),this.reportsCollection.get(n).on("sync",function(){r.reportingDetailsView.beforeRender({objectId:t,reportModel:r.reportsCollection.get(n)})})}else this.reportingDetailsView.beforeRender({objectId:t,reportModel:this.reportsCollection.get(n)})}})}),function(){var e=this,t=e._,n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.push,o=n.slice,u=n.concat,a=r.toString,f=r.hasOwnProperty,l=Array.isArray,c=Object.keys,h=i.bind,p=function(e){return e instanceof p?e:this instanceof p?void (this._wrapped=e):new p(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):e._=p,p.VERSION="1.7.0";var d=function(e,t,n){if(t===void 0)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}};p.iteratee=function(e,t,n){return null==e?p.identity:p.isFunction(e)?d(e,t,n):p.isObject(e)?p.matches(e):p.property(e)},p.each=p.forEach=function(e,t,n){if(null==e)return e;t=d(t,n);var r,i=e.length;if(i===+i)for(r=0;i>r;r++)t(e[r],r,e);else{var s=p.keys(e);for(r=0,i=s.length;i>r;r++)t(e[s[r]],s[r],e)}return e},p.map=p.collect=function(e,t,n){if(null==e)return[];t=p.iteratee(t,n);for(var r,i=e.length!==+e.length&&p.keys(e),s=(i||e).length,o=Array(s),u=0;s>u;u++)r=i?i[u]:u,o[u]=t(e[r],r,e);return o};var v="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(e,t,n,r){null==e&&(e=[]),t=d(t,r,4);var i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length,u=0;if(arguments.length<3){if(!o)throw new TypeError(v);n=e[s?s[u++]:u++]}for(;o>u;u++)i=s?s[u]:u,n=t(n,e[i],i,e);return n},p.reduceRight=p.foldr=function(e,t,n,r){null==e&&(e=[]),t=d(t,r,4);var i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;if(arguments.length<3){if(!o)throw new TypeError(v);n=e[s?s[--o]:--o]}for(;o--;)i=s?s[o]:o,n=t(n,e[i],i,e);return n},p.find=p.detect=function(e,t,n){var r;return t=p.iteratee(t,n),p.some(e,function(e,n,i){return t(e,n,i)?(r=e,!0):void 0}),r},p.filter=p.select=function(e,t,n){var r=[];return null==e?r:(t=p.iteratee(t,n),p.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r)},p.reject=function(e,t,n){return p.filter(e,p.negate(p.iteratee(t)),n)},p.every=p.all=function(e,t,n){if(null==e)return!0;t=p.iteratee(t,n);var r,i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;for(r=0;o>r;r++)if(i=s?s[r]:r,!t(e[i],i,e))return!1;return!0},p.some=p.any=function(e,t,n){if(null==e)return!1;t=p.iteratee(t,n);var r,i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;for(r=0;o>r;r++)if(i=s?s[r]:r,t(e[i],i,e))return!0;return!1},p.contains=p.include=function(e,t){return null==e?!1:(e.length!==+e.length&&(e=p.values(e)),p.indexOf(e,t)>=0)},p.invoke=function(e,t){var n=o.call(arguments,2),r=p.isFunction(t);return p.map(e,function(e){return(r?t:e[t]).apply(e,n)})},p.pluck=function(e,t){return p.map(e,p.property(t))},p.where=function(e,t){return p.filter(e,p.matches(t))},p.findWhere=function(e,t){return p.find(e,p.matches(t))},p.max=function(e,t,n){var r,i,s=-1/0,o=-1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],r>s&&(s=r)}else t=p.iteratee(t,n),p.each(e,function(e,n,r){i=t(e,n,r),(i>o||i===-1/0&&s===-1/0)&&(s=e,o=i)});return s},p.min=function(e,t,n){var r,i,s=1/0,o=1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],s>r&&(s=r)}else t=p.iteratee(t,n),p.each(e,function(e,n,r){i=t(e,n,r),(o>i||1/0===i&&1/0===s)&&(s=e,o=i)});return s},p.shuffle=function(e){for(var t,n=e&&e.length===+e.length?e:p.values(e),r=n.length,i=Array(r),s=0;r>s;s++)t=p.random(0,s),t!==s&&(i[s]=i[t]),i[t]=n[s];return i},p.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=p.values(e)),e[p.random(e.length-1)]):p.shuffle(e).slice(0,Math.max(0,t))},p.sortBy=function(e,t,n){return t=p.iteratee(t,n),p.pluck(p.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var m=function(e){return function(t,n,r){var i={};return n=p.iteratee(n,r),p.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};p.groupBy=m(function(e,t,n){p.has(e,n)?e[n].push(t):e[n]=[t]}),p.indexBy=m(function(e,t,n){e[n]=t}),p.countBy=m(function(e,t,n){p.has(e,n)?e[n]++:e[n]=1}),p.sortedIndex=function(e,t,n,r){n=p.iteratee(n,r,1);for(var i=n(t),s=0,o=e.length;o>s;){var u=s+o>>>1;n(e[u])<i?s=u+1:o=u}return s},p.toArray=function(e){return e?p.isArray(e)?o.call(e):e.length===+e.length?p.map(e,p.identity):p.values(e):[]},p.size=function(e){return null==e?0:e.length===+e.length?e.length:p.keys(e).length},p.partition=function(e,t,n){t=p.iteratee(t,n);var r=[],i=[];return p.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},p.first=p.head=p.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:o.call(e,0,t)},p.initial=function(e,t,n){return o.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},p.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:o.call(e,Math.max(e.length-t,0))},p.rest=p.tail=p.drop=function(e,t,n){return o.call(e,null==t||n?1:t)},p.compact=function(e){return p.filter(e,p.identity)};var g=function(e,t,n,r){if(t&&p.every(e,p.isArray))return u.apply(r,e);for(var i=0,o=e.length;o>i;i++){var a=e[i];p.isArray(a)||p.isArguments(a)?t?s.apply(r,a):g(a,t,n,r):n||r.push(a)}return r};p.flatten=function(e,t){return g(e,t,!1,[])},p.without=function(e){return p.difference(e,o.call(arguments,1))},p.uniq=p.unique=function(e,t,n,r){if(null==e)return[];p.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=p.iteratee(n,r));for(var i=[],s=[],o=0,u=e.length;u>o;o++){var a=e[o];if(t)o&&s===a||i.push(a),s=a;else if(n){var f=n(a,o,e);p.indexOf(s,f)<0&&(s.push(f),i.push(a))}else p.indexOf(i,a)<0&&i.push(a)}return i},p.union=function(){return p.uniq(g(arguments,!0,!0,[]))},p.intersection=function(e){if(null==e)return[];for(var t=[],n=arguments.length,r=0,i=e.length;i>r;r++){var s=e[r];if(!p.contains(t,s)){for(var o=1;n>o&&p.contains(arguments[o],s);o++);o===n&&t.push(s)}}return t},p.difference=function(e){var t=g(o.call(arguments,1),!0,!0,[]);return p.filter(e,function(e){return!p.contains(t,e)})},p.zip=function(e){if(null==e)return[];for(var t=p.max(arguments,"length").length,n=Array(t),r=0;t>r;r++)n[r]=p.pluck(arguments,r);return n},p.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},p.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=p.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}for(;i>r;r++)if(e[r]===t)return r;return-1},p.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=e.length;for("number"==typeof n&&(r=0>n?r+n+1:Math.min(r,n+1));--r>=0;)if(e[r]===t)return r;return-1},p.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;r>s;s++,e+=n)i[s]=e;return i};var y=function(){};p.bind=function(e,t){var n,r;if(h&&e.bind===h)return h.apply(e,o.call(arguments,1));if(!p.isFunction(e))throw new TypeError("Bind must be called on a function");return n=o.call(arguments,2),r=function(){if(this instanceof r){y.prototype=e.prototype;var i=new y;y.prototype=null;var s=e.apply(i,n.concat(o.call(arguments)));return p.isObject(s)?s:i}return e.apply(t,n.concat(o.call(arguments)))}},p.partial=function(e){var t=o.call(arguments,1);return function(){for(var n=0,r=t.slice(),i=0,s=r.length;s>i;i++)r[i]===p&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},p.bindAll=function(e){var t,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(t=1;r>t;t++)n=arguments[t],e[n]=p.bind(e[n],e);return e},p.memoize=function(e,t){var n=function(r){var i=n.cache,s=t?t.apply(this,arguments):r;return p.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},p.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},p.defer=function(e){return p.delay.apply(p,[e,1].concat(o.call(arguments,1)))},p.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:p.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=p.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l||l>t?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),o||(r=i=null)):o||n.trailing===!1||(o=setTimeout(a,l)),s}},p.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=p.now()-o;t>f&&f>0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=p.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},p.wrap=function(e,t){return p.partial(t,e)},p.negate=function(e){return function(){return!e.apply(this,arguments)}},p.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},p.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},p.before=function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},p.once=p.partial(p.before,2),p.keys=function(e){if(!p.isObject(e))return[];if(c)return c(e);var t=[];for(var n in e)p.has(e,n)&&t.push(n);return t},p.values=function(e){for(var t=p.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},p.pairs=function(e){for(var t=p.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},p.invert=function(e){for(var t={},n=p.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},p.functions=p.methods=function(e){var t=[];for(var n in e)p.isFunction(e[n])&&t.push(n);return t.sort()},p.extend=function(e){if(!p.isObject(e))return e;for(var t,n,r=1,i=arguments.length;i>r;r++){t=arguments[r];for(n in t)f.call(t,n)&&(e[n]=t[n])}return e},p.pick=function(e,t,n){var r,i={};if(null==e)return i;if(p.isFunction(t)){t=d(t,n);for(r in e){var s=e[r];t(s,r,e)&&(i[r]=s)}}else{var a=u.apply([],o.call(arguments,1));e=new Object(e);for(var f=0,l=a.length;l>f;f++)r=a[f],r in e&&(i[r]=e[r])}return i},p.omit=function(e,t,n){if(p.isFunction(t))t=p.negate(t);else{var r=p.map(u.apply([],o.call(arguments,1)),String);t=function(e,t){return!p.contains(r,t)}}return p.pick(e,t,n)},p.defaults=function(e){if(!p.isObject(e))return e;for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t];for(var i in r)e[i]===void 0&&(e[i]=r[i])}return e},p.clone=function(e){return p.isObject(e)?p.isArray(e)?e.slice():p.extend({},e):e},p.tap=function(e,t){return t(e),e};var b=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof p&&(e=e._wrapped),t instanceof p&&(t=t._wrapped);var i=a.call(e);if(i!==a.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]===e)return r[s]===t;var o=e.constructor,u=t.constructor;if(o!==u&&"constructor"in e&&"constructor"in t&&!(p.isFunction(o)&&o instanceof o&&p.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var f,l;if("[object Array]"===i){if(f=e.length,l=f===t.length)for(;f--&&(l=b(e[f],t[f],n,r)););}else{var c,h=p.keys(e);if(f=h.length,l=p.keys(t).length===f)for(;f--&&(c=h[f],l=p.has(t,c)&&b(e[c],t[c],n,r)););}return n.pop(),r.pop(),l};p.isEqual=function(e,t){return b(e,t,[],[])},p.isEmpty=function(e){if(null==e)return!0;if(p.isArray(e)||p.isString(e)||p.isArguments(e))return 0===e.length;for(var t in e)if(p.has(e,t))return!1;return!0},p.isElement=function(e){return!!e&&1===e.nodeType},p.isArray=l||function(e){return"[object Array]"===a.call(e)},p.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){p["is"+e]=function(t){return a.call(t)==="[object "+e+"]"}}),p.isArguments(arguments)||(p.isArguments=function(e){return p.has(e,"callee")}),"function"!=typeof /./&&(p.isFunction=function(e){return"function"==typeof e||!1}),p.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},p.isNaN=function(e){return p.isNumber(e)&&e!==+e},p.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===a.call(e)},p.isNull=function(e){return null===e},p.isUndefined=function(e){return e===void 0},p.has=function(e,t){return null!=e&&f.call(e,t)},p.noConflict=function(){return e._=t,this},p.identity=function(e){return e},p.constant=function(e){return function(){return e}},p.noop=function(){},p.property=function(e){return function(t){return t[e]}},p.matches=function(e){var t=p.pairs(e),n=t.length;return function(e){if(null==e)return!n;e=new Object(e);for(var r=0;n>r;r++){var i=t[r],s=i[0];if(i[1]!==e[s]||!(s in e))return!1}return!0}},p.times=function(e,t,n){var r=Array(Math.max(0,e));t=d(t,n,1);for(var i=0;e>i;i++)r[i]=t(i);return r},p.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},p.now=Date.now||function(){return(new Date).getTime()};var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},E=p.invert(w),S=function(e){var t=function(t){return e[t]},n="(?:"+p.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};p.escape=S(w),p.unescape=S(E),p.result=function(e,t){if(null==e)return void 0;var n=e[t];return p.isFunction(n)?e[t]():n};var x=0;p.uniqueId=function(e){var t=++x+"";return e?e+t:t},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},C=/\\|'|\r|\n|\u2028|\u2029/g,k=function(e){return"\\"+N[e]};p.template=function(e,t,n){!t&&n&&(t=n),t=p.defaults({},t,p.templateSettings);var r=RegExp([(t.escape||T).source,(t.interpolate||T).source,(t.evaluate||T).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(C,k),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,p)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},p.chain=function(e){var t=p(e);return t._chain=!0,t};var L=function(e){return this._chain?p(e).chain():e};p.mixin=function(e){p.each(p.functions(e),function(t){var n=p[t]=e[t];p.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),L.call(this,n.apply(p,e))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];p.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],L.call(this,n)}}),p.each(["concat","join","slice"],function(e){var t=n[e];p.prototype[e]=function(){return L.call(this,t.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}.call(this),function(e,t){if(typeof define=="function"&&define.amd)define("backbone",["underscore","exports"],function(n,r){e.Backbone=t(e,r,n,$)});else if(typeof exports!="undefined"){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;!r&&typeof t=="object"&&(r=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,r,this),(s||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return s[o]=t,!i&&typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=r);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r);if(i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},I(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;I(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id],delete this._byId[u.cid],o=this.indexOf(u),this.models.splice(o,1),this.length--,t.silent||(t.index=o,u.trigger("remove",u,this,t)),this._removeReference(u,t)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l,c=t.at,h=this.model,p=this.comparator&&c==null&&t.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!p&&w&&S?[]:!1;for(i=0,s=e.length;i<s;i++){a=e[i]||{},a instanceof d?o=u=a:o=a[h.prototype.idAttribute||"id"];if(f=this.get(o))S&&(b[f.cid]=!0),E&&(a=a===u?u.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),p&&!l&&f.hasChanged(v)&&(l=!0)),e[i]=f;else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u),this._addReference(u,t)}u=f||u,x&&(u.isNew()||!b[u.id])&&x.push(u),b[u.id]=!0}if(S){for(i=0,s=this.length;i<s;++i)b[(u=this.models[i]).cid]||y.push(u);y.length&&this.remove(y,t)}if(m.length||x&&x.length){p&&(l=!0),this.length+=m.length;if(c!=null)for(i=0,s=m.length;i<s;i++)this.models.splice(c+i,0,m[i]);else{x&&(this.models.length=0);var T=x||m;for(i=0,s=T.length;i<s;i++)this.models.push(T[i])}}l&&this.sort({silent:!0});if(!t.silent){for(i=0,s=m.length;i<s;i++)(u=m[i]).trigger("add",u,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return u.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e,t){this._byId[e.cid]=e,e.id!=null&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy","indexBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(S),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||F()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&T&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var T=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/,B=/#.*$/;M.started=!1,n.extend(M.prototype,f,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(H,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/");if(s&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(B,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var j=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),define("jquery",function(){}),function(e,t){typeof define=="function"&&define.amd?define("backboneCache",["underscore","backbone","jquery"],function(n,r,i){return e.Backbone=t(n,r,i)}):typeof exports!="undefined"&&typeof require!="undefined"?module.exports=t(require("underscore"),require("backbone"),require("jquery")):e.Backbone=t(e._,e.Backbone,e.jQuery)}(this,function(e,t,n){function s(t,r){if(t&&e.isObject(t)){if(e.isFunction(t.getCacheKey))return t.getCacheKey(r);r&&r.url?t=r.url:t=e.isFunction(t.url)?t.url():t.url}else if(e.isFunction(t))return t(r);return r&&r.data?typeof r.data=="string"?t+"?"+r.data:t+"?"+n.param(r.data):t}function o(e,n,r){n=n||{};var i=t.fetchCache.getCacheKey(e,n),s=!1,o=n.lastSync||(new Date).getTime(),u=!1;if(!i)return;if(n.cache===!1)return;if(!n.cache&&!n.prefill)return;n.expires!==!1&&(s=(new Date).getTime()+(n.expires||300)*1e3),n.prefillExpires!==!1&&(u=(new Date).getTime()+(n.prefillExpires||300)*1e3),t.fetchCache._cache[i]={expires:s,lastSync:o,prefillExpires:u,value:r},t.fetchCache.setLocalStorage()}function u(n,r){return e.isFunction(n)?n=n():n&&e.isObject(n)&&(n=s(n,r)),t.fetchCache._cache[n]}function a(e,t){return u(e).lastSync}function f(n,r){e.isFunction(n)?n=n():n&&e.isObject(n)&&(n=s(n,r)),delete t.fetchCache._cache[n],t.fetchCache.setLocalStorage()}function l(){if(!i||!t.fetchCache.localStorage)return;try{localStorage.setItem(t.fetchCache.getLocalStorageKey(),JSON.stringify(t.fetchCache._cache))}catch(e){var n=e.code||e.number||e.message;if(n!==22&&n!==1014)throw e;this._deleteCacheWithPriority()}}function c(){if(!i||!t.fetchCache.localStorage)return;var e=localStorage.getItem(t.fetchCache.getLocalStorageKey())||"{}";t.fetchCache._cache=JSON.parse(e)}function h(e){return window.setTimeout(e,0)}var r={modelFetch:t.Model.prototype.fetch,modelSync:t.Model.prototype.sync,collectionFetch:t.Collection.prototype.fetch},i=function(){var e=typeof window.localStorage!="undefined";if(e)try{localStorage.setItem("test_support","test_support"),localStorage.removeItem("test_support")}catch(t){e=!1}return e}();return t.fetchCache=t.fetchCache||{},t.fetchCache._cache=t.fetchCache._cache||{},t.fetchCache.enabled=!0,t.fetchCache.priorityFn=function(e,t){return!e||!e.expires||!t||!t.expires?e:e.expires-t.expires},t.fetchCache._prioritize=function(){var t=e.values(this._cache).sort(this.priorityFn),n=e.indexOf(e.values(this._cache),t[0]);return e.keys(this._cache)[n]},t.fetchCache._deleteCacheWithPriority=function(){t.fetchCache._cache[this._prioritize()]=null,delete t.fetchCache._cache[this._prioritize()],t.fetchCache.setLocalStorage()},t.fetchCache.getLocalStorageKey=function(){return"backboneCache"},typeof t.fetchCache.localStorage=="undefined"&&(t.fetchCache.localStorage=!0),t.Model.prototype.fetch=function(i){function d(){return i.prefill&&(!i.prefillExpires||f)}function v(){i.parse&&(l=p.parse(l,i)),p.set(l,i),e.isFunction(i.prefillSuccess)&&i.prefillSuccess(p,l,i),p.trigger("cachesync",p,l,i),p.trigger("sync",p,l,i),d()?c.notify(p):(e.isFunction(i.success)&&i.success(p,l,i),c.resolve(p))}if(!t.fetchCache.enabled)return r.modelFetch.apply(this,arguments);i=e.defaults(i||{},{parse:!0});var s=t.fetchCache.getCacheKey(this,i),o=u(s),a=!1,f=!1,l=!1,c=new n.Deferred,p=this;o&&(a=o.expires,a=a&&o.expires<(new Date).getTime(),f=o.prefillExpires,f=f&&o.prefillExpires<(new Date).getTime(),l=o.value);if(!a&&(i.cache||i.prefill)&&l){i.async==null&&(i.async=!0),i.async?h(v):v();if(!d())return c}var m=r.modelFetch.apply(this,arguments);return m.done(e.bind(c.resolve,this,this)).done(e.bind(t.fetchCache.setCache,null,this,i)).fail(e.bind(c.reject,this,this)),c.abort=m.abort,c},t.Model.prototype.sync=function(e,n,i){if(e==="read"||!t.fetchCache.enabled)return r.modelSync.apply(this,arguments);var s=n.collection,o=[],u,a;o.push(t.fetchCache.getCacheKey(n,i)),!s||o.push(t.fetchCache.getCacheKey(s));for(u=0,a=o.length;u<a;u++)f(o[u]);return r.modelSync.apply(this,arguments)},t.Collection.prototype.fetch=function(i){function d(){return i.prefill&&(!i.prefillExpires||f)}function v(){p[i.reset?"reset":"set"](l,i),e.isFunction(i.prefillSuccess)&&i.prefillSuccess(p),p.trigger("cachesync",p,l,i),p.trigger("sync",p,l,i),d()?c.notify(p):(e.isFunction(i.success)&&i.success(p,l,i),c.resolve(p))}if(!t.fetchCache.enabled)return r.collectionFetch.apply(this,arguments);i=e.defaults(i||{},{parse:!0});var s=t.fetchCache.getCacheKey(this,i),o=u(s),a=!1,f=!1,l=!1,c=new n.Deferred,p=this;o&&(a=o.expires,a=a&&o.expires<(new Date).getTime(),f=o.prefillExpires,f=f&&o.prefillExpires<(new Date).getTime(),l=o.value);if(!a&&(i.cache||i.prefill)&&l){i.async==null&&(i.async=!0),i.async?h(v):v();if(!d())return c}var m=r.collectionFetch.apply(this,arguments);return m.done(e.bind(c.resolve,this,this)).done(e.bind(t.fetchCache.setCache,null,this,i)).fail(e.bind(c.reject,this,this)),c.abort=m.abort,c},c(),t.fetchCache._superMethods=r,t.fetchCache.setCache=o,t.fetchCache.getCache=u,t.fetchCache.getCacheKey=s,t.fetchCache.getLastSync=a,t.fetchCache.clearItem=f,t.fetchCache.setLocalStorage=l,t.fetchCache.getLocalStorage=c,t}),ICAD.loader={show:function(e){e=e||$("#icad-content"),$("#icad-loader").remove(),e.css("position","relative").append($("<div/>",{id:"icad-loader"}))},hide:function(){$("#icad-loader").remove()}},ICAD.generateId=function(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),ICAD.cloneObject=function(e){if(e===null||typeof e!="object")return e;var t=e.constructor();for(var n in e)t[n]=ICAD.cloneObject(e[n]);return t},ICAD.queryToJson=function(e){e=e.split("+").join(" ");var t,n,r={},i,s=/[?&]?([^=]+)=([^&]*)/g;while(i=s.exec(e))t==decodeURIComponent(i[1])?r[t]instanceof Array?r[t].push(decodeURIComponent(i[2])):(r[t]=[],r[t].push(n),r[t].push(decodeURIComponent(i[2]))):r[decodeURIComponent(i[1])]=decodeURIComponent(i[2]),t=decodeURIComponent(i[1]),n=decodeURIComponent(i[2]);return r},ICAD.onWindowResize=function(e,t){t=t||0;var n=0;return jQuery(window).on("resize",function(){clearTimeout(n),n=setTimeout(e,t)})},ICAD.onScroll=function(e,t,n){n=n||0;var r=0;return e.scroll("scroll",function(){clearTimeout(r),r=setTimeout(t,n)})},ICAD.getFormFields=function(e){var t,n={activity:function(){t={select_market:selectsArrayOptions.markets,select_activity:selectsArrayOptions.activities}},market:function(){t={select_activity:selectsArrayOptions.activities,select_market:selectsArrayOptions.markets}},fmm:function(){t={select_market:selectsArrayOptions.markets,select_activity:selectsArrayOptions.activities,select_fmm:[]}},channel:function(){t={select_market:selectsArrayOptions.markets,select_activity:selectsArrayOptions.activities,select_channel:[]}},week:function(){t={select_market:selectsArrayOptions.markets,select_activity:selectsArrayOptions.activities}},user:function(){t={select_market:selectsArrayOptions.markets,select_activity:selectsArrayOptions.activities,select_user:selectsArrayOptions.user_types}}};return n[e](),t},ICAD.updateFormFields=function(e,t,n){function r(t,r,s){ICAD.loader.show(),e._getData(selectsAjaxUri,{market:parseInt(r),type:t},function(r){$.each(r,function(e,t){i+='<option value="'+t.value+'" title="'+t.name+'">'+t.name+"</option>"}),e.formData["select_"+t]=r,s.html(i),typeof e.reportModel!="undefined"&&n==1&&e._setEditingFieldValues(),ICAD.multiselect.destroy(s),ICAD.multiselect.multipleInit(s,e),ICAD.loader.hide()})}ICAD.DEBUG_MODE?console.info("[hepler.js]: ICAD.updateFormFields() | field name: "+t.attr("name")):!1;var i="",s={channel:function(){t.attr("id")=="select-market"&&r(e.compareId,t.val(),$("#select-channels"))},fmm:function(){t.attr("id")=="select-market"&&r(e.compareId,t.val(),$("#select-fmm"))},market:function(){},week:function(){},activity:function(){},user:function(){}};s[e.compareId]()},ICAD.setAdditionalReportFields=function(e){function n(n){var r={};$.each(n,function(n,i){r[i+"Name"]=_.findWhere(t["select_"+i],{value:parseInt(e.reportModel.attributes.requestObj[i])}).name}),e.reportModel.set(r)}function r(t){if(Backbone.history.fragment.match("reporting/details")){var n=e.reportModel.attributes.formData["select_"+e.reportModel.attributes.compareId],r=e.objectId.match(/^[-]?[0-9]+$/)?parseInt(e.objectId):e.objectId;_.findWhere(n,{value:r})?e.reportModel.attributes[t]=_.findWhere(n,{value:r}).name:e.reportModel.attributes[t]=""}else e.reportModel.unset(t)}ICAD.DEBUG_MODE&&console.info("[helpers.js]: ICAD.setAdditionalReportFields()");var t=ICAD.getFormFields(e.reportModel.attributes.compareId),i={activity:function(){n(["market"]),r("activityName")},market:function(){n(["activity"]),r("marketName")},fmm:function(){n(["market","activity"]),r("fmmName")},channel:function(){n(["market","activity"]),r("channelName")},user:function(){n(["market","activity"]),r("userName")},week:function(){n(["market","activity"]),Backbone.history.fragment.match("reporting/details")?e.reportModel.attributes.weekName=e.reportModel.attributes.requestObj.period:e.reportModel.unset("weekName")}};i[e.reportModel.attributes.compareId]()},ICAD.getScrollBarWidth=function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var r=n.offsetWidth;return e.parentNode.removeChild(e),t-r},ICAD.getParameterByName=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=n.exec(t);return r===null?"":decodeURIComponent(r[1].replace(/\+/g," "))},ICAD.updateQueryStringParameter=function(e,t,n){var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),i=e.indexOf("?")!==-1?"&":"?";return e.match(r)?e.replace(r,"$1"+t+"="+n+"$2"):e+i+t+"="+n},define("Helpers/helpers",function(){}),ICAD.error={errorMsgDiv:$("<div/>",{"class":"error-msg js-error-msg"}),datepicker:{format:"Incorrect date format. </br> Example: [20.01.2015]",range:"Incorrect date range. </br> Example: [20.01.2015]",notMonday:"This day is not Monday.",notSunday:"This day is not Sunday."}},ICAD.validate={datepickerMask:/\b\d{2}[.]\d{2}[.]\d{4}\b/,datepicker:function(e){function u(e,n){n=n||r,n.find(".js-error-msg").length&&n.find(".js-error-msg").remove(),ICAD.error.errorMsgDiv.clone().appendTo(t.closest(".item-wrapper")),n.find(".js-error-msg").html(e)}var t=e.currentTarget?$(e.currentTarget):e,n=!0,r=t.closest(".item-wrapper");ICAD.DEBUG_MODE&&console.info("[validator.js]: validate datepicker #"+t.attr("id"));var i=$("#start-date").datepicker("getDate"),s=$("#end-date").datepicker("getDate"),o=864e5;return r.hasClass("error-item-wrapper")||(!ICAD.validate.datepickerMask.test(t.val())&&t.val().length>0?(u(ICAD.error.datepicker.format),n=!1):(r.find(".js-error-msg").html(""),Date.parse(i)+o>Date.parse(s)||Date.parse(s)>Date.parse(ICAD.limitDate)?(u(ICAD.error.datepicker.range),n=!1):($(".datepicker .js-error-msg").html(""),$(".datepicker__wrap").removeClass("error-item-wrapper")))),n},reportModel:function(e){ICAD.DEBUG_MODE&&console.info("[validator.js]: validate report model");var t=e.toJSON(),n=!0;return typeof t["id"]!=e.default["id"]&&(n=!1),typeof t["request"]!=e.default["request"]&&(n=!1),typeof t["requestObj"]!=e.default["requestObj"]&&(n=!1),typeof t["compareId"]!=e.default["compareId"]&&(n=!1),typeof t["isSaved"]!=e.default["isSaved"]&&(n=!1),t.formData instanceof Array&&(n=!1),n}},define("Helpers/validator",function(){}),Handlebars.registerHelper("url",function(e,t){return new Handlebars.SafeString('<a class="simple-link" href='+e+">"+t.fn(this)+"</a>")}),Handlebars.registerHelper("each",function(e,t,n){var r="";if(!n){n=t;for(var i=0;i<e.length;i++)r+=n.fn(e[i])}else r+=n.fn(e[t]);return r}),Handlebars.registerHelper("list",function(e,t){var n="<ul>";for(var r=0,i=e.length;r<i;r++)n+=t.fn(e[r]);return n+"</ul>"}),Handlebars.registerHelper("equal",function(e,t,n){if(arguments.length<3)throw new Error("Handlebars Helper equal needs 2 parameters");if(e===""||typeof e=="undefined")e=0;return e!==t?n.inverse(this):n.fn(this)}),Handlebars.registerHelper("if",function(e,t){return e?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("dateReplaceDotOnSlash",function(e){return e=Handlebars.escapeExpression(e),e=e.replace(/\./g,"/"),new Handlebars.SafeString(e)}),Handlebars.registerHelper("unless",function(e,t){return e?t.inverse(this):t.fn(this)}),Handlebars.registerHelper("emptyStrInNbsp",function(e){return e=Handlebars.escapeExpression(e),e==""&&(e="&nbsp;n/a"),new Handlebars.SafeString(e)}),Handlebars.registerHelper("dateEmptyStrInNbsp",function(e){e=Handlebars.escapeExpression(e);if(e=="")e="&nbsp;n/a";else{e=parseInt(e);var t=(new Date(e)).getDate().toString().length==2?(new Date(e)).getDate():"0"+(new Date(e)).getDate(),n=((new Date(e)).getMonth()+1).toString().length==2?(new Date(e)).getMonth()+1:"0"+((new Date(e)).getMonth()+1),r="20"+((new Date(e)).getYear()+"").slice(1);e=t+"-"+n+"-"+r}return new Handlebars.SafeString(e)}),define("Helpers/handlebars-extend",function(){}),$.datepicker._updateDatepicker_original=$.datepicker._updateDatepicker,$.datepicker._updateDatepicker=function(e){$.datepicker._updateDatepicker_original(e);var t=this._get(e,"afterShow");t(e)},define("Helpers/datepicker-extend",function(){}),ICAD.multiselect={singleInit:function(e,t){e.multiselect({header:!1,multiple:!1,selectedList:1,height:150,open:function(e,t){$(this).multiselect("widget").find(".ui-multiselect-checkboxes input:checked").parents("li").hide(),$(this).multiselect("widget").find(".ui-multiselect-checkboxes input:not(:checked)").parents("li").show(),$(this).multiselect("widget").find(".ui-multiselect-checkboxes").jScrollPane(jScrollPane_settings)}})},multipleInit:function(e,t){e.multiselect({selectedList:1,height:150,noneSelectedText:e.data("text"),open:function(e,t){$(this).multiselect("widget").find(".ui-multiselect-checkboxes").jScrollPane(jScrollPane_settings),$(this).multiselect("widget").find("input:checked").length<$(this).multiselect("widget").find("input").length?ICAD.multiselect._showMultiselectAll($(this)):ICAD.multiselect._showMultiselectNone($(this))},checkAll:function(e,n){ICAD.multiselect._showMultiselectNone($(this)),t.updateMultipleSelectList($(this))},uncheckAll:function(e,n){ICAD.multiselect._showMultiselectAll($(this)),t.updateMultipleSelectList($(this))},click:function(e,n){$(this).multiselect("widget").find("input:checked").length<$(this).multiselect("widget").find("input").length?ICAD.multiselect._showMultiselectAll($(this)):ICAD.multiselect._showMultiselectNone($(this)),t.updateMultipleSelectList($(this))},create:function(){t.updateMultipleSelectList($(this))}})},destroy:function(e){e.multiselect("destroy")},_showMultiselectAll:function(e){e.multiselect("widget").find(".ui-multiselect-all").show(),e.multiselect("widget").find(".ui-multiselect-none").hide()},_showMultiselectNone:function(e){e.multiselect("widget").find(".ui-multiselect-all").hide(),e.multiselect("widget").find(".ui-multiselect-none").show()}},define("Helpers/multiselect-customize",function(){}),require(["Helpers/global-events","MainRouter","backboneCache","Helpers/helpers","Helpers/validator","Helpers/handlebars-extend","Helpers/datepicker-extend","Helpers/multiselect-customize"],function(e,t){new t,Backbone.history.start(),globalHelpers.FOUC($(".icad-container.js-fouc"),1e3)}),define("app/app-init",function(){});